# Source: https://docs.searxng.org/admin/installation-apache.html

[]

# Apache[¶](#apache "Link to this heading")

This section explains how to set up a SearXNG instance using the HTTP server [Apache](https://httpd.apache.org/). If you did use the [[Installation Script]](installation-scripts.html#installation-scripts) and do not have any special preferences you can install the [[SearXNG site]](#apache-searxng-site) using [[searxng.sh]](../utils/searxng.sh.html#searxng-sh-overview):

    $ sudo -H ./utils/searxng.sh install apache

If you have special interests or problems with setting up Apache, the following section might give you some guidance.

further read

-   [Apache Arch Linux](https://wiki.archlinux.org/index.php/Apache_HTTP_Server)

-   [Apache Debian](https://cwiki.apache.org/confluence/display/HTTPD/DistrosDefaultLayout#DistrosDefaultLayout-Debian,Ubuntu(Apachehttpd2.x):)

-   [apache2.README.Debian](https://salsa.debian.org/apache-team/apache2/raw/master/debian/apache2.README.Debian)

-   [Apache Fedora](https://docs.fedoraproject.org/en-US/quick-docs/getting-started-with-apache-http-server/index.html)

-   [Apache directives](https://httpd.apache.org/docs/trunk/mod/directives.html)

```
<!-- -->
```
-   [The Apache HTTP server](#the-apache-http-server)

    -   [Debian's Apache layout](#debian-s-apache-layout)

    -   [Apache modules](#apache-modules)

    -   [Apache sites](#apache-sites)

-   [Apache's SearXNG site](#apache-s-searxng-site)

-   [disable logs](#disable-logs)

## [The Apache HTTP server](#id5)[¶](#the-apache-http-server "Link to this heading")

If [Apache](https://httpd.apache.org/) is not installed, install it now. If [apache](https://httpd.apache.org/) is new to you, the [Getting Started](https://httpd.apache.org/docs/current/en/getting-started.html), [Configuration Files](https://httpd.apache.org/docs/current/en/configuring.html) and [Terms Used to Describe Directives](https://httpd.apache.org/docs/current/en/mod/directive-dict.html) documentation gives first orientation. There is also a list of [Apache directives](https://httpd.apache.org/docs/trunk/mod/directives.html) *to keep in the pocket*.

Ubuntu / debian

Arch Linux

Fedora / RHEL

    sudo -H apt-get install apache2

    sudo -H pacman -S apache
    sudo -H systemctl enable httpd
    sudo -H systemctl start http

    sudo -H dnf install httpd
    sudo -H systemctl enable httpd
    sudo -H systemctl start httpd

Now at [http://localhost](http://localhost) you should see some kind of *Welcome* or *Test* page. How this default site is configured, depends on the linux distribution (compare [Apache directives](https://httpd.apache.org/docs/trunk/mod/directives.html)).

Ubuntu / debian

Arch Linux

Fedora / RHEL

    less /etc/apache2/sites-enabled/000-default.conf

In this file, there is a line setting the [DocumentRoot](https://httpd.apache.org/docs/trunk/mod/core.html#documentroot) directive:

    DocumentRoot /var/www/html

And the *welcome* page is the HTML file at [`/var/www/html/index.html`].

    less /etc/httpd/conf/httpd.conf

In this file, there is a line setting the [DocumentRoot](https://httpd.apache.org/docs/trunk/mod/core.html#documentroot) directive:

    DocumentRoot "/srv/http"
    <Directory "/srv/http">
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

The *welcome* page of Arch Linux is a page showing the directory located at [`DocumentRoot`]. This *directory* page is generated by the Module [mod_autoindex](https://httpd.apache.org/docs/2.4/mod/mod_autoindex.html):

    LoadModule autoindex_module modules/mod_autoindex.so
    ...
    Include conf/extra/httpd-autoindex.conf

    less /etc/httpd/conf/httpd.conf

In this file, there is a line setting the [`DocumentRoot`] directive:

    DocumentRoot "/var/www/html"
    ...
    <Directory "/var/www">
        AllowOverride None
        # Allow open access:
        Require all granted
    </Directory>

On fresh installations, the [`/var/www`] is empty and the *default welcome page* is shown, the configuration is located at:

    less /etc/httpd/conf.d/welcome.conf

[]

### [Debian's Apache layout](#id6)[¶](#debian-s-apache-layout "Link to this heading")

Be aware, Debian's Apache layout is quite different from the standard Apache configuration. For details look at the [apache2.README.Debian](https://salsa.debian.org/apache-team/apache2/raw/master/debian/apache2.README.Debian) ([`/usr/share/doc/apache2/README.Debian.gz`]). Some commands you should know on Debian:

-   [apache2ctl](https://manpages.debian.org/jump?q=apache2ctl): Apache HTTP server control interface

-   [a2enmod](https://manpages.debian.org/jump?q=a2enmod), [a2dismod](https://manpages.debian.org/jump?q=a2dismod): switch on/off modules

-   [a2enconf](https://manpages.debian.org/jump?q=a2enconf), [a2disconf](https://manpages.debian.org/jump?q=a2disconf): switch on/off configurations

-   [a2ensite](https://manpages.debian.org/jump?q=a2ensite), [a2dissite](https://manpages.debian.org/jump?q=a2dissite): switch on/off sites

[]

### [Apache modules](#id7)[¶](#apache-modules "Link to this heading")

To load additional modules, in most distributions you have to uncomment the lines with the corresponding [LoadModule](https://httpd.apache.org/docs/mod/mod_so.html#loadmodule) directive, except in [[Debian's Apache layout]](#debian-s-apache-layout).

Ubuntu / debian

Arch Linux

Fedora / RHEL

[[Debian's Apache layout]](#debian-s-apache-layout) uses [a2enmod](https://manpages.debian.org/jump?q=a2enmod) and [a2dismod](https://manpages.debian.org/jump?q=a2dismod) to activate or disable modules:

    sudo -H a2enmod ssl
    sudo -H a2enmod headers
    sudo -H a2enmod proxy
    sudo -H a2enmod proxy_http
    sudo -H a2enmod proxy_uwsgi

In the [`/etc/httpd/conf/httpd.conf`] file, activate [LoadModule](https://httpd.apache.org/docs/mod/mod_so.html#loadmodule) directives:

    LoadModule ssl_module           modules/mod_ssl.so
    LoadModule headers_module       modules/mod_headers.so
    LoadModule proxy_module         modules/mod_proxy.so
    LoadModule proxy_http_module    modules/mod_proxy_http.so
    LoadModule proxy_uwsgi_module   modules/mod_proxy_uwsgi.so

In the [`/etc/httpd/conf/httpd.conf`] file, activate [LoadModule](https://httpd.apache.org/docs/mod/mod_so.html#loadmodule) directives:

    LoadModule ssl_module           modules/mod_ssl.so
    LoadModule headers_module       modules/mod_headers.so
    LoadModule proxy_module         modules/mod_proxy.so
    LoadModule proxy_http_module    modules/mod_proxy_http.so
    LoadModule proxy_uwsgi_module   modules/mod_proxy_uwsgi.so

[]

### [Apache sites](#id8)[¶](#apache-sites "Link to this heading")

Ubuntu / debian

Arch Linux

Fedora / RHEL

In [[Debian's Apache layout]](#debian-s-apache-layout) you create a [`searxng.conf`] with the [`<Location`]` `[`/searxng`]` `[`>`] directive and save this file in the *sites available* folder at [`/etc/apache2/sites-available`]. To enable the [`searxng.conf`] use [a2ensite](https://manpages.debian.org/jump?q=a2ensite):

    sudo -H a2ensite searxng.conf

In the [`/etc/httpd/conf/httpd.conf`] file add a [IncludeOptional](https://httpd.apache.org/docs/mod/core.html#includeoptional) directive:

    IncludeOptional sites-enabled/*.conf

Create two folders, one for the *available sites* and one for the *enabled sites*:

    mkdir -p /etc/httpd/sites-available
    mkdir -p /etc/httpd/sites-enabled

Create configuration at [`/etc/httpd/sites-available`] and place a symlink to [`sites-enabled`]:

    sudo -H ln -s /etc/httpd/sites-available/searxng.conf \
                  /etc/httpd/sites-enabled/searxng.conf

In the [`/etc/httpd/conf/httpd.conf`] file add a [IncludeOptional](https://httpd.apache.org/docs/mod/core.html#includeoptional) directive:

    IncludeOptional sites-enabled/*.conf

Create two folders, one for the *available sites* and one for the *enabled sites*:

    mkdir -p /etc/httpd/sites-available
    mkdir -p /etc/httpd/sites-enabled

Create configuration at [`/etc/httpd/sites-available`] and place a symlink to [`sites-enabled`]:

    sudo -H ln -s /etc/httpd/sites-available/searxng.conf \
                  /etc/httpd/sites-enabled/searxng.conf

[]

## [Apache's SearXNG site](#id9)[¶](#apache-s-searxng-site "Link to this heading")

uWSGI

Use [mod_proxy_uwsgi](https://uwsgi-docs.readthedocs.io/en/latest/Apache.html#mod-proxy-uwsgi) / don't use the old [mod_uwsgi](https://uwsgi-docs.readthedocs.io/en/latest/Apache.html#mod-uwsgi) anymore.

To proxy the incoming requests to the SearXNG instance Apache needs the [mod_proxy](https://httpd.apache.org/docs/current/mod/mod_proxy.html) module ([[Apache modules]](#apache-modules)).

HTTP headers

With [ProxyPreserveHost](https://httpd.apache.org/docs/trunk/mod/mod_proxy.html#proxypreservehost) the incoming [`Host`] header is passed to the proxied host.

Depending on what your SearXNG installation is listening on, you need a http [mod_proxy_http](https://httpd.apache.org/docs/current/mod/mod_proxy_http.html)) or socket ([mod_proxy_uwsgi](https://uwsgi-docs.readthedocs.io/en/latest/Apache.html#mod-proxy-uwsgi)) communication to upstream.

The [[Installation Script]](installation-scripts.html#installation-scripts) installs the [[reference setup]](installation-searxng.html#use-default-settings-yml) and a [[uWSGI setup]](installation-uwsgi.html#uwsgi-setup) that listens on a socket by default. You can install and activate your own [`searxng.conf`] like shown in [[Apache sites]](#apache-sites).

socket

http

    # -*- coding: utf-8; mode: apache -*-

    LoadModule ssl_module           /mod_ssl.so
    LoadModule headers_module       /mod_headers.so
    LoadModule proxy_module         /mod_proxy.so
    LoadModule proxy_uwsgi_module   /mod_proxy_uwsgi.so
    # LoadModule setenvif_module      /mod_setenvif.so
    #
    # SetEnvIf Request_URI /searxng dontlog
    # CustomLog /dev/null combined env=dontlog

    <Location /searxng>

        Require all granted
        Order deny,allow
        Deny from all
        # Allow from fd00::/8 192.168.0.0/16 fe80::/10 127.0.0.0/8 ::1
        Allow from all

        # add the trailing slash
        RedirectMatch  308 /searxng$ /searxng/

        ProxyPreserveHost On
        ProxyPass unix:/usr/local/searxng/run/socket|uwsgi://uwsgi-uds-searxng/

        # see flaskfix.py
        RequestHeader set X-Forwarded-Proto %s
        RequestHeader set X-Script-Name /searxng

        # see botdetection/trusted_proxies.py
        RequestHeader set X-Real-IP %s
        RequestHeader append X-Forwarded-For %s

    </Location>

    # To serve the static files via the HTTP server
    #
    # Alias /searxng/static/ /usr/local/searxng/searxng-src/searx/static/

    # -*- coding: utf-8; mode: apache -*-

    LoadModule ssl_module           /mod_ssl.so
    LoadModule headers_module       /mod_headers.so
    LoadModule proxy_module         /mod_proxy.so
    LoadModule proxy_http_module    /mod_proxy_http.so
    # LoadModule setenvif_module      /mod_setenvif.so
    #
    # SetEnvIf Request_URI /searxng dontlog
    # CustomLog /dev/null combined env=dontlog

    <Location /searxng>

        Require all granted
        Order deny,allow
        Deny from all
        # Allow from fd00::/8 192.168.0.0/16 fe80::/10 127.0.0.0/8 ::1
        Allow from all

        # add the trailing slash
        RedirectMatch  308 /searxng$ /searxng/

        ProxyPreserveHost On
        ProxyPass http://127.0.0.1:8888

        # see flaskfix.py
        RequestHeader set X-Forwarded-Proto %s
        RequestHeader set X-Script-Name /searxng

        # see botdetection/trusted_proxies.py
        RequestHeader set X-Real-IP %s
        RequestHeader append X-Forwarded-For %s

    </Location>

    # To serve the static files via the HTTP server
    #
    # Alias /searxng/static/ /usr/local/searxng/searxng-src/searx/static/

Restart service:

Ubuntu / debian

Arch Linux

Fedora / RHEL

    sudo -H systemctl restart apache2
    sudo -H service uwsgi restart searxng

    sudo -H systemctl restart httpd
    sudo -H systemctl restart uwsgi@searxng

    sudo -H systemctl restart httpd
    sudo -H touch /etc/uwsgi.d/searxng.ini

## [disable logs](#id10)[¶](#disable-logs "Link to this heading")

For better privacy you can disable Apache logs. In the examples above activate one of the lines and [restart apache](#restart-apache):

    SetEnvIf Request_URI "/searxng" dontlog
    # CustomLog /dev/null combined env=dontlog

The [`CustomLog`] directive disables logs for the entire (virtual) server, use it when the URL of the service does not have a path component ([`/searxng`]), so when SearXNG is located at root ([`/`]).