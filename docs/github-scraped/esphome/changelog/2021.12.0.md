---
description: "Changelog for ESPHome 2021.12.0."
title: "ESPHome 2021.12.0 - 11th December 2021"
params:
  seo:
    description: Changelog for ESPHome 2021.12.0.
    image: /_static/changelog-2021.12.0.png
---

{{< imgtable >}}
"Button Core","components/button/index","folder-open.svg","dark-invert"
"Template Button","components/button/template","description.svg","dark-invert"
"Restart Button","components/button/restart","restart.svg","dark-invert"
"BLE Binary Output","components/output/ble_client","bluetooth.svg","dark-invert"
"Tuya Text Sensor","components/text_sensor/tuya","tuya.png",""
"SDP800 Series","components/sensor/sdp3x","sdp31.jpg","Pressure"
{{< /imgtable >}}

## State of the Open Smart Home

Today is the [State of the Open Smart Home](https://www.home-assistant.io/state-of-the-open-home/) hosted by Nabu
Casa, Home Assistant & ESPHome and we'll be joined by our friends from WLED, Z-Wave JS, Stanford's OVAL lab and
Northeastern University to talk about our work on making this vision a reality.

Where: YouTube

When: Today, Saturday, December 11, at 11am PST / 8pm CET

<!-- markdownlint-disable-next-line MD033 -->
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/6ZMXE5PXPqU"
        title="YouTube video player" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
</iframe>

## Buttons

This release brings {{< docref "/components/button/index" "buttons" >}} from Home Assistant. Many times there have
been questions on how to simply trigger automations from the Home Assistant frontend with a button so here you go.
Here is a very simple example:

```yaml
button:
  - platform: template
    name: Test Button
    on_press:
      then:
        - logger.log: "The button was pressed!!!"
```

## Multiple WiFi networks with static IP

This release has a fix that allows using multiple networks each with their own static IP address configuration.
When using these options, you **must** also set `wifi` -> `use_address` when installing new firmware as ESPHome
cannot know which IP address to use automatically.

## The Dashboard and secrets

The ESPHome Dashboard will now save the wifi credentials as secrets (`wifi_ssid` / `wifi_password`  ) for future use.
If you are already using these secrets, then the dashboard will not ask for credentials and will configure using
them for you.

The dashboard also now can view the logs straight from a serial connected device via the web browser. It will
show up as an option when choosing the method to view them.

## NEC remote protocol

In this version, the order of transferring bits was corrected from MSB to LSB in accordance with the NEC standard.
Therefore, if the configuration file has come from an earlier version of ESPhome, it is necessary to reverse
the order of the address and command bits when moving to 2021.12 or above.
For example, address: `0x84ED`, command: `0x13EC` becomes `0xB721` and `0x37C8` respectively.

## Tuya Covers

{{< pr number="2637" repo="esphome" >}} adds new functionality to the Tuya cover component, but at the same time
removes the "soft" inversion of the direction. Instead, it seems that most if not all tuya covers have a "hidden"
datapoint that sets the direction on the secondary MCU. See the {{< docref "/components/cover/tuya" "documentation" >}}
for the new configuration options.

<!-- markdownlint-disable MD013 -->

## Release 2021.12.1 - December 15

- Set text sensor state property to filter output {{< pr number="2893" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Allow button POST on press from web server {{< pr number="2913" repo="esphome" >}} by {{< ghuser name="wilberforce" >}}

## Release 2021.12.2 - December 21

- Don't disable idle task WDT when it's not enabled {{< pr number="2856" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Fix MQTT button press action {{< pr number="2917" repo="esphome" >}} by {{< ghuser name="oxan" >}}

## Release 2021.12.3 - December 30

- Require arduino in webserver for better validation {{< pr number="2941" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Only allow internal pins for dht sensor {{< pr number="2940" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Workaround installing as editable package not working {{< pr number="2936" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Remove -e for hassio images {{< pr number="2964" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}

## Full list of changes

### New Features

- pmsx003: add support for new PMS5003S device {{< pr number="2710" repo="esphome" >}} by {{< ghuser name="NeoAcheron" >}} (new-feature)
- Add climate on_state trigger {{< pr number="2707" repo="esphome" >}} by {{< ghuser name="dudanov" >}} (new-feature)
- Add greeyac protocol to IR Climate / HeatpumpIR {{< pr number="2694" repo="esphome" >}} by {{< ghuser name="cmroche" >}} (new-feature)
- Provide an option to select unique_id generator {{< pr number="2701" repo="esphome" >}} by {{< ghuser name="kbialek" >}} (new-feature)
- Ignore secrets yaml on command line {{< pr number="2715" repo="esphome" >}} by {{< ghuser name="cvwillegen" >}} (new-feature)
- Add max_telegram_length option to dsmr {{< pr number="2674" repo="esphome" >}} by {{< ghuser name="mmakaay" >}} (new-feature)
- Relax the icon validator to allow non-mdi icons {{< pr number="2764" repo="esphome" >}} by {{< ghuser name="paulmonigatti" >}} (new-feature)
- Add support for P1 Data Request pin control {{< pr number="2676" repo="esphome" >}} by {{< ghuser name="mmakaay" >}} (new-feature)
- Add support for sdp8xx {{< pr number="2779" repo="esphome" >}} by {{< ghuser name="martgras" >}} (new-feature)
- Add map filter for text sensors {{< pr number="2761" repo="esphome" >}} by {{< ghuser name="oxan" >}} (new-feature)
- Optionally show internal components on the web server {{< pr number="2627" repo="esphome" >}} by {{< ghuser name="mechanarchy" >}} (new-feature)
- cse7766: add energy sensor {{< pr number="2822" repo="esphome" >}} by {{< ghuser name="ianchi" >}} (new-feature)
- Allow Git credentials to be loaded from secrets {{< pr number="2825" repo="esphome" >}} by {{< ghuser name="mechanarchy" >}} (new-feature)
- Expand uart invert feature to ESP8266 {{< pr number="1727" repo="esphome" >}} by {{< ghuser name="Lewn" >}} (new-feature)

### New Components

- Add ble_client binary_output {{< pr number="2200" repo="esphome" >}} by {{< ghuser name="tekmaven" >}} (new-integration)
- Add support for button entities {{< pr number="2824" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (new-integration)

### Breaking Changes

- Fix NEC protocol implementation {{< pr number="2534" repo="esphome" >}} by {{< ghuser name="dudanov" >}} (breaking-change)
- Tuya Cover improvements {{< pr number="2637" repo="esphome" >}} by {{< ghuser name="pauln" >}} (breaking-change)

### Beta Changes

- Feed watchdog during OTA {{< pr number="2852" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Bump esphome-dashboard to 20211206.0 {{< pr number="2870" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- tlc59208f : fix compilation error {{< pr number="2867" repo="esphome" >}} by {{< ghuser name="martgras" >}}
- ADC: Turn verbose the debugging "got voltage" {{< pr number="2863" repo="esphome" >}} by {{< ghuser name="CarlosGS" >}}
- SPS30 : fix i2c read size {{< pr number="2866" repo="esphome" >}} by {{< ghuser name="martgras" >}}
- Fix MCP23x17 not disabling pullup after config change {{< pr number="2855" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Ignore already stopped dhcp for ethernet {{< pr number="2862" repo="esphome" >}} by {{< ghuser name="madron" >}}
- Add endpoint to fetch secrets keys {{< pr number="2873" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Adopt using wifi secrets that should exist at this point {{< pr number="2874" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Allow wizard to specify secrets {{< pr number="2875" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Feed watchdog when no component loops {{< pr number="2857" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Bump esphome-dashboard to 20211207.0 {{< pr number="2877" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Feed watchdog while setting up OTA {{< pr number="2876" repo="esphome" >}} by {{< ghuser name="CarlosGS" >}}
- Use new platform component config blocks for wizard {{< pr number="2885" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Bump esphome-dashboard to 20211208.0 {{< pr number="2887" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix published state for modbus number {{< pr number="2894" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Modbus number/output use write single {{< pr number="2896" repo="esphome" >}} by {{< ghuser name="glmnet" >}}
- Fix for two points setting when fan_only_cooling is disabled {{< pr number="2903" repo="esphome" >}} by {{< ghuser name="kbx81" >}}
- Bump esphome-dashboard to 20211211.0 {{< pr number="2904" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}

### All changes

- Defines tidy {{< pr number="2696" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- pmsx003: add support for new PMS5003S device {{< pr number="2710" repo="esphome" >}} by {{< ghuser name="NeoAcheron" >}} (new-feature)
- Add climate on_state trigger {{< pr number="2707" repo="esphome" >}} by {{< ghuser name="dudanov" >}} (new-feature)
- Add greeyac protocol to IR Climate / HeatpumpIR {{< pr number="2694" repo="esphome" >}} by {{< ghuser name="cmroche" >}} (new-feature)
- Fix rom/rtc.h deprecation compile warning for debug component {{< pr number="2520" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- Drop unused constants from const.py {{< pr number="2718" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Install test requirements in lint Docker image {{< pr number="2719" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Clean-up MAC address helpers {{< pr number="2713" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Provide an option to select unique_id generator {{< pr number="2701" repo="esphome" >}} by {{< ghuser name="kbialek" >}} (new-feature)
- Ignore secrets yaml on command line {{< pr number="2715" repo="esphome" >}} by {{< ghuser name="cvwillegen" >}} (new-feature)
- Allow for subsecond sampling of hmc5883l {{< pr number="2735" repo="esphome" >}} by {{< ghuser name="jaharkes" >}}
- Change log level from DEBUG to INFO for sniffing services of `rf_bridge` {{< pr number="2736" repo="esphome" >}} by {{< ghuser name="nagyrobi" >}}
- Add ble_client binary_output {{< pr number="2200" repo="esphome" >}} by {{< ghuser name="tekmaven" >}} (new-integration)
- Remove duplicated const data in esp8266 boards {{< pr number="2740" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Move to use improv lib from platformio {{< pr number="2741" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Add max_telegram_length option to dsmr {{< pr number="2674" repo="esphome" >}} by {{< ghuser name="mmakaay" >}} (new-feature)
- Changed LUT for DKE epaper on ttgo t5 2.13inch to improve partial rfresh {{< pr number="2475" repo="esphome" >}} by {{< ghuser name="spattinson" >}}
- Fix NEC protocol implementation {{< pr number="2534" repo="esphome" >}} by {{< ghuser name="dudanov" >}} (breaking-change)
- Remove arduino dependency from hm3301 {{< pr number="2745" repo="esphome" >}} by {{< ghuser name="martgras" >}}
- Add retry handler {{< pr number="2721" repo="esphome" >}} by {{< ghuser name="martgras" >}}
- Introduce str_snprintf helper function {{< pr number="2780" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Prettier date time display after time sync {{< pr number="2778" repo="esphome" >}} by {{< ghuser name="cvwillegen" >}}
- Fix distorted gif frames when resizing {{< pr number="2774" repo="esphome" >}} by {{< ghuser name="davet2001" >}}
- fixed wrong setup-usage tc9548a {{< pr number="2766" repo="esphome" >}} by {{< ghuser name="andreashergert1984" >}}
- Relax the icon validator to allow non-mdi icons {{< pr number="2764" repo="esphome" >}} by {{< ghuser name="paulmonigatti" >}} (new-feature)
- Bump black from 21.10b0 to 21.11b1 {{< pr number="2760" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- Update aht10.cpp to address issue #1635 {{< pr number="2675" repo="esphome" >}} by {{< ghuser name="krunkel" >}}
- Add support for P1 Data Request pin control {{< pr number="2676" repo="esphome" >}} by {{< ghuser name="mmakaay" >}} (new-feature)
- Allow specifying the dashboard bind address {{< pr number="2787" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- remove LEDC_HIGH_SPEED_MODE for C3, S2, S3 {{< pr number="2791" repo="esphome" >}} by {{< ghuser name="martgras" >}}
- Fix LEDC resolution calculation on ESP32-C3/S2/S3 {{< pr number="2794" repo="esphome" >}} by {{< ghuser name="rsumner" >}}
- Add support for sdp8xx {{< pr number="2779" repo="esphome" >}} by {{< ghuser name="martgras" >}} (new-feature)
- Allow empty UART debug: option, logging in hex format by default {{< pr number="2771" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- Bump pylint from 2.11.1 to 2.12.1 {{< pr number="2798" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- Fix CI cache key for test3.yaml compile {{< pr number="2757" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Drop obsolete comment from CI workflow file {{< pr number="2758" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Cache virtualenv instead of pip cache between CI runs {{< pr number="2759" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Add map filter for text sensors {{< pr number="2761" repo="esphome" >}} by {{< ghuser name="oxan" >}} (new-feature)
- Only match GCC warnings from ESPHome source files in CI {{< pr number="2756" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Correct constant for dynamic I2S bus in NeoPixelBus {{< pr number="2797" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Consistently format errors in CI scripts {{< pr number="2762" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Cancel previous workflows for PRs and branches {{< pr number="2800" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- total_daily_energy: allow to disable restore mode {{< pr number="2795" repo="esphome" >}} by {{< ghuser name="ianchi" >}}
- Modbus_controller: Add custom command. {{< pr number="2680" repo="esphome" >}} by {{< ghuser name="martgras" >}}
- Fix usage of deprecated climate method in anova {{< pr number="2801" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Make clang-tidy suggest stdint.h int types {{< pr number="2820" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Fixed data type inside fast_random_8() routine {{< pr number="2818" repo="esphome" >}} by {{< ghuser name="anatoly-savchenkov" >}}
- Improve DSMR read timeout handling {{< pr number="2699" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- Optionally show internal components on the web server {{< pr number="2627" repo="esphome" >}} by {{< ghuser name="mechanarchy" >}} (new-feature)
- Fix custom mode_state_topic {{< pr number="2827" repo="esphome" >}} by {{< ghuser name="definitio" >}}
- Add support for button entities {{< pr number="2824" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (new-integration)
- Tuya text_sensor and raw data usage {{< pr number="1812" repo="esphome" >}} by {{< ghuser name="dentra" >}}
- Fix 8266 SPI Clock Polarity Setting {{< pr number="2836" repo="esphome" >}} by {{< ghuser name="kbx81" >}}
- Fix too-broad matcher for custom CI script {{< pr number="2829" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- cse7766: add energy sensor {{< pr number="2822" repo="esphome" >}} by {{< ghuser name="ianchi" >}} (new-feature)
- Burst read for BME280, to reduce spurious spikes {{< pr number="2809" repo="esphome" >}} by {{< ghuser name="CarlosGS" >}}
- Bump aioesphomeapi from 10.2.0 to 10.6.0 {{< pr number="2840" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- Button device class {{< pr number="2835" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Implement unit_of_measurement for number component {{< pr number="2804" repo="esphome" >}} by {{< ghuser name="puuu" >}}
- Number mode {{< pr number="2838" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Bump esphome-dashboard to 20211201.0 {{< pr number="2842" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Allow Git credentials to be loaded from secrets {{< pr number="2825" repo="esphome" >}} by {{< ghuser name="mechanarchy" >}} (new-feature)
- Fix compile warning in Tuya automations {{< pr number="2837" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Add problem matcher for Python formatting errors {{< pr number="2833" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Fix CI check for Windows line endings {{< pr number="2831" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Don't enable namespace comment clang-tidy check twice {{< pr number="2830" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- ESP32 Deep Sleep: correct level value {{< pr number="2812" repo="esphome" >}} by {{< ghuser name="jhamhader" >}}
- Fix OTA updates on esp8266 by declaring arch_get_cpu_cycle_count IRAM_ATTR and HOT {{< pr number="2843" repo="esphome" >}} by {{< ghuser name="Doridian" >}}
- Fix compilation using subprocesses {{< pr number="2834" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Expand uart invert feature to ESP8266 {{< pr number="1727" repo="esphome" >}} by {{< ghuser name="Lewn" >}} (new-feature)
- Support setting manual_ip under networks option {{< pr number="2839" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Enable a bunch of clang-tidy checks {{< pr number="2149" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Set ESP32 watchdog to loop task {{< pr number="2846" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Tuya Cover improvements {{< pr number="2637" repo="esphome" >}} by {{< ghuser name="pauln" >}} (breaking-change)
- Fix wifi not working with manual_ip using esp-idf {{< pr number="2849" repo="esphome" >}} by {{< ghuser name="Maelstrom96" >}}
- modbus_controller: bugfix: enable overriding calculated register size {{< pr number="2845" repo="esphome" >}} by {{< ghuser name="martgras" >}}
- Feed watchdog during OTA {{< pr number="2852" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Bump esphome-dashboard to 20211206.0 {{< pr number="2870" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- tlc59208f : fix compilation error {{< pr number="2867" repo="esphome" >}} by {{< ghuser name="martgras" >}}
- ADC: Turn verbose the debugging "got voltage" {{< pr number="2863" repo="esphome" >}} by {{< ghuser name="CarlosGS" >}}
- SPS30 : fix i2c read size {{< pr number="2866" repo="esphome" >}} by {{< ghuser name="martgras" >}}
- Fix MCP23x17 not disabling pullup after config change {{< pr number="2855" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Ignore already stopped dhcp for ethernet {{< pr number="2862" repo="esphome" >}} by {{< ghuser name="madron" >}}
- Add endpoint to fetch secrets keys {{< pr number="2873" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Adopt using wifi secrets that should exist at this point {{< pr number="2874" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Allow wizard to specify secrets {{< pr number="2875" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Feed watchdog when no component loops {{< pr number="2857" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Bump esphome-dashboard to 20211207.0 {{< pr number="2877" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Feed watchdog while setting up OTA {{< pr number="2876" repo="esphome" >}} by {{< ghuser name="CarlosGS" >}}
- Use new platform component config blocks for wizard {{< pr number="2885" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Bump esphome-dashboard to 20211208.0 {{< pr number="2887" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix published state for modbus number {{< pr number="2894" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Modbus number/output use write single {{< pr number="2896" repo="esphome" >}} by {{< ghuser name="glmnet" >}}
- Fix for two points setting when fan_only_cooling is disabled {{< pr number="2903" repo="esphome" >}} by {{< ghuser name="kbx81" >}}
- Bump esphome-dashboard to 20211211.0 {{< pr number="2904" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}

<!-- markdownlint-enable MD013 -->

## All Changelogs

{{< changelogs >}}
