---
description: "Changelog for ESPHome 2021.9.0."
title: "ESPHome 2021.9.0 - 15th September 2021"
params:
  seo:
    description: Changelog for ESPHome 2021.9.0.
    image: /_static/changelog-2021.9.0.png
---

{{< imgtable >}}
"AirThings BLE","components/sensor/airthings_ble","airthings_logo.png",""
"H-bridge Fan","components/fan/hbridge","fan.svg","dark-invert"
"ST7920","components/display/st7920","st7920.jpg",""
{{< /imgtable >}}

## Web Server Vulnerability

It was brought to our attention by {{< ghuser name="andir" >}} that the {{< docref "/components/web_server" >}}
had a vulnerability in that the OTA form could be POST'd to without the basic auth credentials set in the `web_server`
configuration. If you use the `web_server` and rely on the credentials for security, then you need to upgrade
to 2021.9.2 or disable the `web_server` completely. The [Security Advisory on GitHub](https://github.com/esphome/esphome/security/advisories/GHSA-48mj-p7x2-5jfm)
has been given `CVE-2021-41104`.

## [Home Assistant Yellow](https://home-assistant.io/yellow)

You get the most out of your ESPHome devices when you combine it with Home Assistant,
which offers a seamless and local integration to control and manage all your ESPHome devices.
Today Home Assistant launched a crowdfunding campaign for the [Home Assistant Yellow](https://home-assistant.io/yellow),
the easiest way to get started with Home Assistant and a privacy focused smart home.

## API Encryption

{{< ghuser name="OttoWinter" >}} has been hard at work adding a layer of encryption to the API which utilises the
`noise` protocol. This releases adds the capabilities to ESPHome devices, but Home Assistant (or other clients)
will need to upgrade their client libraries (e.g. `aioesphomeapi`  ) before they can connect and communicate to
devices with encryption. This is scheduled to be available in Home Assistant 2021.10.

## Git Packages

[Packages](/components/packages#config-git_packages) have been extended to allow loading (multiple) YAML file(s) from a git repo.
Take a look at the examples to see how to use them.

## Midea AC

`platform: midea_ac` has been changed to `platform: midea` in this release and has
quite a few upgrades. Check the docs for the new features. {{< docref "/components/climate/midea" >}}

## SDM Meters

{{< docref "/components/sensor/sdm_meter" "SDM Meters" >}} have been fixed to use kWh instead of Wh
as the energy unit of measurement.

## Template Select/Number/Switch

The template selects, numbers and switches now have more validations on them preventing weird usage.
If you do not set a `lambda` then you are required to make them either `optimistic: true`, or
utilise the `set_action` (select/number) / `turn_on_trigger` (switch).

<!-- markdownlint-disable MD013 -->

## Release 2021.9.1 - September 20

- Fix MQTT discovery for sensor state_class {{< pr number="2331" repo="esphome" >}} by {{< ghuser name="paulmonigatti" >}}
- Light transition fixes {{< pr number="2320" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Cease using deprecated Cover methods in automations {{< pr number="2326" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Apply color brightness to addressable light effects {{< pr number="2321" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Add readv and writev for more efficient API packets {{< pr number="2342" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Clean-up sensor integration {{< pr number="2275" repo="esphome" >}} by {{< ghuser name="oxan" >}}

## Release 2021.9.2 - September 28

- Bump aioesphomeapi to 9.1.1 {{< pr number="2350" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Midea fix {{< pr number="2395" repo="esphome" >}} by {{< ghuser name="dudanov" >}}
- Move web_server auth to web_server_base [be965a6](https://github.com/esphome/esphome/commit/be965a60eba6bb769e2a5afdbc8eed132f077a59) by {{< ghuser name="OttoWinter" >}}
- Fix lint issues in web_server_base {{< pr number="2409" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}

## Release 2021.9.3 - October 7

- Re-enable TCP nodelay for ESP32 {{< pr number="2390" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Bump aioesphomeapi from 9.1.1 to 9.1.2 {{< pr number="2426" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- Fix socket abstraction for ESP-IDF v4 {{< pr number="2434" repo="esphome" >}} by {{< ghuser name="agners" >}}
- Bump aioesphomeapi from 9.1.2 to 9.1.4 {{< pr number="2443" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- Add log line to show if API encryption is being used {{< pr number="2450" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- API encryption switch to libsodium backend {{< pr number="2456" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}

## Full list of changes

### New Features

- Add H-Bridge fan component {{< pr number="2212" repo="esphome" >}} by {{< ghuser name="WeekendWarrior1" >}} (new-feature)
- Allow using a git source for a package {{< pr number="2193" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (new-feature)

### New Components

- Add st7920 display, {{< pr number="1440" repo="esphome" >}} by {{< ghuser name="marsjan155" >}} (new-integration)
- Support for the AirThings Wave Plus {{< pr number="1656" repo="esphome" >}} by {{< ghuser name="jeromelaban" >}} (new-integration)

### Breaking Changes

- Fix SDM energy units to be KILO... {{< pr number="2206" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (breaking-change)
- Reject template select/number/switches that don't handle user input {{< pr number="2230" repo="esphome" >}} by {{< ghuser name="oxan" >}} (breaking-change)
- Remove last_reset_type and convert all those sensors to TOTAL_INCREASING {{< pr number="2233" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (breaking-change)
- Midea support v2 {{< pr number="2188" repo="esphome" >}} by {{< ghuser name="dudanov" >}} (breaking-change)

### Beta Fixes

- Fix a few ESP32-C3 compiler issues {{< pr number="2265" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- sm300d2: Accept (undocumented) 0x80 checksum offset. {{< pr number="2263" repo="esphome" >}} by {{< ghuser name="poptix" >}}
- Disable automatic usage of SNTP servers from DHCP {{< pr number="2273" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Only try compat parsing after regular parsing fails {{< pr number="2269" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Suppress excessive warnings about deprecated Fan interfaces {{< pr number="2270" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- t6615: tolerate sensor dropping commands {{< pr number="2255" repo="esphome" >}} by {{< ghuser name="jasstrong" >}}
- Fix API socket issues {{< pr number="2288" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Bump platformio to 5.2.0 {{< pr number="2291" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- API Noise logging {{< pr number="2298" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Fix api noise explicit reject {{< pr number="2297" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Allow simple hostname for sntp servers {{< pr number="2300" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix binary strobe {{< pr number="2301" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix unit of measurement fields for DSMR power consumed/delivered fields {{< pr number="2304" repo="esphome" >}} by {{< ghuser name="jsuanet" >}}
- Simple time.sleep in place of threading wait due to upgraded zeroconf {{< pr number="2307" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix aioesphomeapi API logger with explicit API port config {{< pr number="2310" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- Start a wifi scan after saving station details {{< pr number="2315" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}

### All changes

- Minor code cleanup in light components {{< pr number="2162" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- Add device class update to binary sensor {{< pr number="2170" repo="esphome" >}} by {{< ghuser name="frenck" >}}
- Total daily energy methods {{< pr number="2163" repo="esphome" >}} by {{< ghuser name="nuttytree" >}}
- Set SDM voltage state class to measurement {{< pr number="2181" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Add macros header with more usable Arduino version defines {{< pr number="2145" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Clean-up constant definitions {{< pr number="2148" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Remove double scheduling from addressable lights {{< pr number="1963" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Reduce static RAM usage {{< pr number="2140" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Fix template select log message mentioning number {{< pr number="2194" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Add deprecated attribute to some deprecated types/methods {{< pr number="2185" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Store source package in Component for debugging {{< pr number="2070" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- ST7789V: Make backlight_pin optional {{< pr number="2180" repo="esphome" >}} by {{< ghuser name="speijnik" >}}
- Fix SDM energy units to be KILO... {{< pr number="2206" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (breaking-change)
- Optionally set direction on fan.turn_on action {{< pr number="2171" repo="esphome" >}} by {{< ghuser name="WeekendWarrior1" >}}
- Add st7920 display, {{< pr number="1440" repo="esphome" >}} by {{< ghuser name="marsjan155" >}} (new-integration)
- Fix css/js file loading for webserver when esphome not executed form config directory {{< pr number="2207" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- cs_pin made optional for ili9341 {{< pr number="2219" repo="esphome" >}} by {{< ghuser name="a13ssandr0" >}}
- Fix Packages when using MQTT {{< pr number="2210" repo="esphome" >}} by {{< ghuser name="paulmonigatti" >}}
- Update known boards {{< pr number="2190" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Bump dashboard to 20210826.0 {{< pr number="2211" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Remove footer validation for fujitsu_general {{< pr number="2196" repo="esphome" >}} by {{< ghuser name="marciogranzotto" >}}
- Glmnet schema 202105 {{< pr number="2220" repo="esphome" >}} by {{< ghuser name="glmnet" >}}
- Add H-Bridge fan component {{< pr number="2212" repo="esphome" >}} by {{< ghuser name="WeekendWarrior1" >}} (new-feature)
- Bump black from 21.7b0 to 21.8b0 {{< pr number="2222" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- Bump pytest from 6.2.4 to 6.2.5 {{< pr number="2223" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- Support for the AirThings Wave Plus {{< pr number="1656" repo="esphome" >}} by {{< ghuser name="jeromelaban" >}} (new-integration)
- Fix some lint errors in pylint 2.10.2 {{< pr number="2226" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Add transitions to light flash {{< pr number="2201" repo="esphome" >}} by {{< ghuser name="alexyao2015" >}}
- iBeacon support for ble_presence {{< pr number="1627" repo="esphome" >}} by {{< ghuser name="ignisf" >}}
- Cleanup flash transitions {{< pr number="2227" repo="esphome" >}} by {{< ghuser name="alexyao2015" >}}
- Add is_on and is_off conditions for the fan component {{< pr number="2225" repo="esphome" >}} by {{< ghuser name="nuttytree" >}}
- Bump pylint from 2.9.6 to 2.10.2 {{< pr number="2197" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- mqtt_sensor: properly send state_class via MQTT {{< pr number="2228" repo="esphome" >}} by {{< ghuser name="ayufan" >}}
- Change uptime's state_class to total_increasing (esphome/issues#2337) {{< pr number="2205" repo="esphome" >}} by {{< ghuser name="DAVe3283" >}}
- Expose WHITE/CWWW/RGBCT color modes over MQTT {{< pr number="2231" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Reject template select/number/switches that don't handle user input {{< pr number="2230" repo="esphome" >}} by {{< ghuser name="oxan" >}} (breaking-change)
- Fix UARTComponent hardware vs software UART0 conflict {{< pr number="2229" repo="esphome" >}} by {{< ghuser name="ferbar" >}}
- Move to use zeroconf library instead of inline copy {{< pr number="2192" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Allow using a git source for a package {{< pr number="2193" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (new-feature)
- Remove last_reset_type and convert all those sensors to TOTAL_INCREASING {{< pr number="2233" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (breaking-change)
- Dont dump legacy fields {{< pr number="2241" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix encoding bug {{< pr number="2242" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Light: include ON_OFF capability to BRIGHTNESS ColorMode {{< pr number="2204" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- LOG_UPDATE_INTERVAL: correctly report "never" {{< pr number="2240" repo="esphome" >}} by {{< ghuser name="Habbie" >}}
- Fix runtime exception due to dict typing {{< pr number="2243" repo="esphome" >}} by {{< ghuser name="alexyao2015" >}}
- template: select: fix initial_value cannot be used with lambda {{< pr number="2244" repo="esphome" >}} by {{< ghuser name="ayufan" >}}
- Add device classes new in HA 2021.9 {{< pr number="2248" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Logger prevent recursive logging {{< pr number="2251" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Add new trigger to fan component `on_speed_set` {{< pr number="2246" repo="esphome" >}} by {{< ghuser name="dgtal1" >}}
- Fix fan speed restore issue on boot {{< pr number="1867" repo="esphome" >}} by {{< ghuser name="wifwucite" >}}
- Template sensors always publish on update interval {{< pr number="2224" repo="esphome" >}} by {{< ghuser name="nuttytree" >}}
- Socket component {{< pr number="2250" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Allow .yml files in dashboard {{< pr number="2257" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Bump dashboard to 20210908.0 and fix card names for yml {{< pr number="2258" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix socket not setting callbacks early enough {{< pr number="2260" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Convert API to use sockets {{< pr number="2253" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Midea support v2 {{< pr number="2188" repo="esphome" >}} by {{< ghuser name="dudanov" >}} (breaking-change)
- ccs811: publish firmware version; log bootloader and HW version; fix a bug {{< pr number="2006" repo="esphome" >}} by {{< ghuser name="Habbie" >}}
- API encryption {{< pr number="2254" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Revert "Dont dump legacy fields" {{< pr number="2259" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- pm1006: add support for sending a measurement request {{< pr number="2214" repo="esphome" >}} by {{< ghuser name="Habbie" >}}
- SGP40 sensor start-up fix {{< pr number="2178" repo="esphome" >}} by {{< ghuser name="kbx81" >}}
- PMSA003i Update state_class and async {{< pr number="2216" repo="esphome" >}} by {{< ghuser name="sjtrny" >}}
- Fix a few ESP32-C3 compiler issues {{< pr number="2265" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- sm300d2: Accept (undocumented) 0x80 checksum offset. {{< pr number="2263" repo="esphome" >}} by {{< ghuser name="poptix" >}}
- Disable automatic usage of SNTP servers from DHCP {{< pr number="2273" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Only try compat parsing after regular parsing fails {{< pr number="2269" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- Suppress excessive warnings about deprecated Fan interfaces {{< pr number="2270" repo="esphome" >}} by {{< ghuser name="oxan" >}}
- t6615: tolerate sensor dropping commands {{< pr number="2255" repo="esphome" >}} by {{< ghuser name="jasstrong" >}}
- Fix API socket issues {{< pr number="2288" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Bump platformio to 5.2.0 {{< pr number="2291" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- API Noise logging {{< pr number="2298" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Fix api noise explicit reject {{< pr number="2297" repo="esphome" >}} by {{< ghuser name="OttoWinter" >}}
- Allow simple hostname for sntp servers {{< pr number="2300" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix binary strobe {{< pr number="2301" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix unit of measurement fields for DSMR power consumed/delivered fields {{< pr number="2304" repo="esphome" >}} by {{< ghuser name="jsuanet" >}}
- Simple time.sleep in place of threading wait due to upgraded zeroconf {{< pr number="2307" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix aioesphomeapi API logger with explicit API port config {{< pr number="2310" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- Start a wifi scan after saving station details {{< pr number="2315" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}

<!-- markdownlint-enable MD013 -->

## All Changelogs

{{< changelogs >}}
