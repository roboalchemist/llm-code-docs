---
description: "Changelog for ESPHome 2022.6.0."
title: "ESPHome 2022.6.0 - 15th June 2022"
params:
  seo:
    description: Changelog for ESPHome 2022.6.0.
    image: /_static/changelog-2022.6.0.png
---

{{< imgtable >}}
"Tuya Select","components/select/tuya","tuya.png",""
"SGP41","components/sensor/sgp4x","sgp40.jpg",""
"Media Player Core","components/media_player/index","folder-open.svg","dark-invert"
"I2S Audio","components/media_player/i2s_audio","i2s_audio.svg",""
{{< /imgtable >}}
We are almost half way through 2022 already! My, how fast time flies when we
are having fun with ESPHome. This release is kind of small, but packs some big features.
There will be no 2022.7.0 (July) release next month as I ({{< ghuser name="jesserockz" >}}) will be away
around that time. So lets hope we can make 2022.8.0 worth the wait.

## ðŸŽ¶ðŸŽ¶ðŸŽ¶ Media Players

ESPHome can now become a media player target for Home Assistant. This allows users to buy or build
ESP32 based speakers and place them around the house.

We made a small website showing you a few tested [Media Players](https://esphome.github.io/media-players) and you can
install ESPHome directly to them via the browser using ESP Web Tools.

Join us in a live stream all about Audio in the Open Home!

When: Thursday, June 16, at 7pm UTC / 12pm PST / 9pm CET

<!-- markdownlint-disable-next-line MD033 -->
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/SEH-DxOsywg"
        title="YouTube video player" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
</iframe>

## Includes with vars

{{< ghuser name="jimtng" >}} is a newcomer to ESPHome. While migrating everything from a certain other
firmware, they found that they had to duplicate lots of yaml configuration for their many devices.
Basically, they decided to upgrade the `!include` yaml "directive" to allow variables.

```yaml
# device.yaml
binary_sensor:
  - <<: !include
      file: bin-sensor.yaml
      vars:
        pin: GPIO1
        name: "Binary Sensor 1"
        switch: my_switch_1_id
        delay: 10s
  - <<: !include
      file: bin-sensor.yaml
      vars:
        pin: GPIO1
        name: "Binary Sensor 2"
        switch: my_switch_2_id
        delay: 60s

# bin-sensor.yaml
platform: gpio
pin: ${pin}
name: ${name}
on_press:
  - switch.turn_on: ${switch}
  - delay: ${delay}
  - switch.turn_off: ${switch}
```

Now while this is probably not the best example, the variables act as `substitutions`
and can be used anywhere in the underlying yaml file and can very much DRY out your configurations.

<!-- markdownlint-disable MD013 -->

## Release 2022.6.1 - June 18

- Setup the mute pin if configured {{< pr number="3568" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Bugfix for ExternalRAMAllocator copy constructor {{< pr number="3571" repo="esphome" >}} by {{< ghuser name="bnw" >}}
- Media Player: added triggers {{< pr number="3576" repo="esphome" >}} by {{< ghuser name="dudanov" >}}

## Release 2022.6.2 - June 23

- Move gas mbus config option being a define to being a build flag {{< pr number="3575" repo="esphome" >}} by {{< ghuser name="lkomurcu" >}}
- Fix: Make MQTT over TLS actually work {{< pr number="3580" repo="esphome" >}} by {{< ghuser name="ShellAddicted" >}}
- Fix wrong type for voc_state*_ in sgp4x component {{< pr number="3581" repo="esphome" >}} by {{< ghuser name="kahrendt" >}}
- Media Player: added play_media action {{< pr number="3579" repo="esphome" >}} by {{< ghuser name="dudanov" >}}
- Fix 2 small issues in BLEClient {{< pr number="3544" repo="esphome" >}} by {{< ghuser name="jhansche" >}}

## Release 2022.6.3 - August 8

- FIX: Modbus queue deduplicator deleting custom commands {{< pr number="3650" repo="esphome" >}} by {{< ghuser name="jpeletier" >}}
- Update inkbird_ibsth1_mini.cpp {{< pr number="3664" repo="esphome" >}} by {{< ghuser name="ssieb" >}}
- Add CO device class to binary_sensor {{< pr number="3656" repo="esphome" >}} by {{< ghuser name="berg" >}}
- Use application/json instead of text/json {{< pr number="3671" repo="esphome" >}} by {{< ghuser name="ssieb" >}}
- Use correct struct members. {{< pr number="3672" repo="esphome" >}} by {{< ghuser name="ssieb" >}}

## Breaking Changes

### TCS34725 integration time

The sampling settings for the TCS34725 have had a new option `auto` added and set as the default. This allows for better accuracy.
You are able to set it back to the previous default value by specifying `integration_time: 2.4ms` in your configuration.

### SGP40 moved

While adding support for the SGP41 chip, the SGP40 was moved and they were both combined into a new `sgp4x` component.

### MQTT fan speeds

{{< pr number="3397" repo="esphome" >}} removes deprecated MQTT fan speed state and speed command topics.
These were replaced with speed level state and command topics in ESPHome 2021.10.0.

### AC Dimmer

Due to an output power calculation the perceived power might vary slightly specially in the lower and upper regions.

### DisplayBuffer

A new virtual method was added to the DisplayBuffer class for specifying the display type. This change only affects `external_components`.
See {{< pr number="3430" repo="esphome" >}} for more details.

## Full list of changes

### New Components

- Add Tuya select {{< pr number="3469" repo="esphome" >}} by {{< ghuser name="bearpawmaxim" >}} (new-integration)
- Add support for SGP41 {{< pr number="3382" repo="esphome" >}} by {{< ghuser name="martgras" >}} (new-integration) (breaking-change)
- Implement Media Player and I2S Media player {{< pr number="3487" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (new-integration)

### Breaking Changes

- Tcs34725 automatic sampling settings for improved dynamics and accuracy {{< pr number="3258" repo="esphome" >}} by {{< ghuser name="swifty99" >}} (breaking-change)
- Add support for SGP41 {{< pr number="3382" repo="esphome" >}} by {{< ghuser name="martgras" >}} (new-integration) (breaking-change)
- Remove deprecated fan speeds {{< pr number="3397" repo="esphome" >}} by {{< ghuser name="kbickar" >}} (breaking-change)
- Output a true RMS voltage % {{< pr number="3494" repo="esphome" >}} by {{< ghuser name="josephdouce" >}} (breaking-change)
- Add display_type property to DisplayBuffer {{< pr number="3430" repo="esphome" >}} by {{< ghuser name="guillempages" >}} (breaking-change)

### Beta Changes

- publish fan speed count for discovery {{< pr number="3537" repo="esphome" >}} by {{< ghuser name="ssieb" >}}
- Nextion brightness setting requires an assignment {{< pr number="3533" repo="esphome" >}} by {{< ghuser name="nagyv" >}}
- Implement media player volume actions {{< pr number="3551" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix compilation with ESP32-S3 {{< pr number="3543" repo="esphome" >}} by {{< ghuser name="misery" >}}
- Bm3xx: Fix typo {{< pr number="3559" repo="esphome" >}} by {{< ghuser name="martgras" >}}

### Notable Changes

- Add variable substitutions for !include {{< pr number="3510" repo="esphome" >}} by {{< ghuser name="jimtng" >}} (notable-change)

### All changes

- Tcs34725 automatic sampling settings for improved dynamics and accuracy {{< pr number="3258" repo="esphome" >}} by {{< ghuser name="swifty99" >}} (breaking-change)
- Remove duplicate convert_to_8bit_color function. {{< pr number="2469" repo="esphome" >}} by {{< ghuser name="davet2001" >}}
- Bump esptool from 3.3 to 3.3.1 {{< pr number="3468" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- Bump pylint from 2.13.8 to 2.13.9 {{< pr number="3470" repo="esphome" >}} by {{< ghuser name="dependabot[bot]" >}}
- Tuya status gpio support {{< pr number="3466" repo="esphome" >}} by {{< ghuser name="bearpawmaxim" >}}
- Add Tuya select {{< pr number="3469" repo="esphome" >}} by {{< ghuser name="bearpawmaxim" >}} (new-integration)
- MQTT cover: send state even if position is available {{< pr number="3473" repo="esphome" >}} by {{< ghuser name="pyos" >}}
- Ili9341 8bit indexed mode pt1 {{< pr number="2490" repo="esphome" >}} by {{< ghuser name="davet2001" >}}
- feat: esp32-camera add stream event {{< pr number="3285" repo="esphome" >}} by {{< ghuser name="myml" >}}
- Add support for SGP41 {{< pr number="3382" repo="esphome" >}} by {{< ghuser name="martgras" >}} (new-integration) (breaking-change)
- add support user-defined modbus functions {{< pr number="3461" repo="esphome" >}} by {{< ghuser name="gazoodle" >}}
- Remove deprecated fan speeds {{< pr number="3397" repo="esphome" >}} by {{< ghuser name="kbickar" >}} (breaking-change)
- Fix compile issues on windows {{< pr number="3491" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- midea: New power_toggle action. Auto-use remote transmitter. {{< pr number="3496" repo="esphome" >}} by {{< ghuser name="dudanov" >}}
- Output a true RMS voltage % {{< pr number="3494" repo="esphome" >}} by {{< ghuser name="josephdouce" >}} (breaking-change)
- [scd4x] Fix not passing arguments to templatable value for perform_forced_calibration {{< pr number="3495" repo="esphome" >}} by {{< ghuser name="Wumpf" >}}
- Thermostat preset with modes {{< pr number="3298" repo="esphome" >}} by {{< ghuser name="MrMDavidson" >}}
- Allow Prometheus component to export internal components {{< pr number="3508" repo="esphome" >}} by {{< ghuser name="jangrewe" >}}
- [BedJet] Add configurable heating strategy {{< pr number="3519" repo="esphome" >}} by {{< ghuser name="jhansche" >}}
- Add variable substitutions for !include {{< pr number="3510" repo="esphome" >}} by {{< ghuser name="jimtng" >}} (notable-change)
- Change rain intensity sensor string {{< pr number="3511" repo="esphome" >}} by {{< ghuser name="wtremmel" >}}
- Implement Media Player and I2S Media player {{< pr number="3487" repo="esphome" >}} by {{< ghuser name="jesserockz" >}} (new-integration)
- Add mqtt.on_connect and mqtt.on_disconnect triggers {{< pr number="3520" repo="esphome" >}} by {{< ghuser name="jimtng" >}}
- Refactor clock syncing {{< pr number="3503" repo="esphome" >}} by {{< ghuser name="jhansche" >}}
- Added RC6 protocol support {{< pr number="3514" repo="esphome" >}} by {{< ghuser name="Emrvb" >}}
- Add display_type property to DisplayBuffer {{< pr number="3430" repo="esphome" >}} by {{< ghuser name="guillempages" >}} (breaking-change)
- Correct ADC auto-range for ESP32-S2 variant (13 bit adc) {{< pr number="3158" repo="esphome" >}} by {{< ghuser name="CarlosGS" >}}
- Suppress first rotary encoder event {{< pr number="3532" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- Fix endless 'WiFi Unknown connection status 0' loop {{< pr number="3530" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- support rotated ILI9341 (ILI9342) {{< pr number="3526" repo="esphome" >}} by {{< ghuser name="ssieb" >}}
- Fix sdp3x error checking {{< pr number="3531" repo="esphome" >}} by {{< ghuser name="Azimath" >}}
- Fix percentage validation for wrong data type input {{< pr number="3524" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- Block Tuya light from reacting to dp changes if transitioning {{< pr number="3076" repo="esphome" >}} by {{< ghuser name="VitaliyKurokhtin" >}}
- Cleanup deprecated EntityBase::hash_base() {{< pr number="3525" repo="esphome" >}} by {{< ghuser name="mmakaay" >}}
- Fix bogus reading on no communication with MAX31865 {{< pr number="3505" repo="esphome" >}} by {{< ghuser name="DAVe3283" >}}
- Implement the media player actions {{< pr number="3534" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- RG15 data is float/double, not int {{< pr number="3512" repo="esphome" >}} by {{< ghuser name="wtremmel" >}}
- publish fan speed count for discovery {{< pr number="3537" repo="esphome" >}} by {{< ghuser name="ssieb" >}}
- Nextion brightness setting requires an assignment {{< pr number="3533" repo="esphome" >}} by {{< ghuser name="nagyv" >}}
- Implement media player volume actions {{< pr number="3551" repo="esphome" >}} by {{< ghuser name="jesserockz" >}}
- Fix compilation with ESP32-S3 {{< pr number="3543" repo="esphome" >}} by {{< ghuser name="misery" >}}
- Bm3xx: Fix typo {{< pr number="3559" repo="esphome" >}} by {{< ghuser name="martgras" >}}

<!-- markdownlint-enable MD013 -->

## All Changelogs

{{< changelogs >}}
