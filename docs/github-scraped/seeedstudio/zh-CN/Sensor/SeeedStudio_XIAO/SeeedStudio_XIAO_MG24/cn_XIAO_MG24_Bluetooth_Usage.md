---
description: ä½¿ç”¨ Seeed Studio XIAO MG24 çš„è“ç‰™åŠŸèƒ½ã€‚
title: Seeed Studio XIAO MG24 è“ç‰™ä½¿ç”¨
keywords:
- MG24
- xiao
- ble
- bluetooth
image: https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/ble-cover.webp
slug: /cn/xiao_mg24_bluetooth
last_update:
  date: 02/8/2025
  author: Hugo
---

# ä½¿ç”¨ Seeed Studio XIAO MG24 çš„è“ç‰™åŠŸèƒ½

<div class="table-center">
	<table align="center">
		<tr>
			<th>Seeed Studio XIAO MG24</th>
			<th>Seeed Studio XIAO MG24 Sense</th>
		</tr>
		<tr>
			<td><div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Getting_Start/shop0.jpg" style={{width:250, height:'auto'}}/></div></td>
			<td><div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Getting_Start/shop.jpg" style={{width:250, height:'auto'}}/></div></td>
		</tr>
		<tr>
			<td><div class="get_one_now_container" style={{textAlign: 'center'}}>
				<a class="get_one_now_item" href="https://www.seeedstudio.com/Seeed-Studio-XIAO-MG24-p-6247.html" target="_blank">
				<strong><span><font color={'FFFFFF'} size={"4"}> ç«‹å³è´­ä¹° ğŸ–±ï¸</font></span></strong>
				</a>
			</div></td>
			<td><div class="get_one_now_container" style={{textAlign: 'center'}}>
				<a class="get_one_now_item" href="https://www.seeedstudio.com/Seeed-XIAO-MG24-Sense-p-6248.html" target="_blank">
				<strong><span><font color={'FFFFFF'} size={"4"}> ç«‹å³è´­ä¹° ğŸ–±ï¸</font></span></strong>
				</a>
			</div></td>
		</tr>
	</table>

</div>

Seeed Studio XIAO MG24 æ˜¯ä¸€æ¬¾å¼ºå¤§çš„å¼€å‘æ¿ï¼Œæ”¯æŒè“ç‰™ LE 5.3 å’Œè“ç‰™ç½‘æ ¼ï¼Œä½¿å…¶æˆä¸ºéœ€è¦æ— çº¿è¿æ¥çš„å„ç§ç‰©è”ç½‘åº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚å‡­å€Ÿå…¶å“è¶Šçš„å°„é¢‘æ€§èƒ½ï¼ŒXIAO MG24 å¯åœ¨å„ç§è·ç¦»ä¸Šæä¾›å¯é çš„é«˜é€Ÿæ— çº¿é€šä¿¡ï¼Œä½¿å…¶æˆä¸ºçŸ­è·ç¦»å’Œé•¿è·ç¦»åº”ç”¨çš„å¤šåŠŸèƒ½è§£å†³æ–¹æ¡ˆã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢ XIAO MG24 è“ç‰™åŠŸèƒ½çš„åŸºæœ¬ç‰¹æ€§ï¼ŒåŒ…æ‹¬å¦‚ä½•æ‰«æé™„è¿‘çš„è“ç‰™è®¾å¤‡ã€å»ºç«‹è“ç‰™è¿æ¥ä»¥åŠé€šè¿‡è¯¥è¿æ¥ä¼ è¾“å’Œæ¥æ”¶æ•°æ®ã€‚

## å¤©çº¿åˆ‡æ¢æ–¹æ³•

Seeed Studio XIAO MG24 æœ‰ä¸¤ç§å¤©çº¿é€‰é¡¹ï¼šå†…ç½®å¤©çº¿å’Œå¤–ç½®å¤©çº¿ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨å†…ç½®å¤©çº¿ï¼Œä¸ºäº†å¢å¼ºä¿¡å·å¼ºåº¦ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å¤–ç½®å¤©çº¿ã€‚ä»¥ä¸‹æ˜¯åœ¨ä¸¤ç§å¤©çº¿ä¹‹é—´åˆ‡æ¢çš„æ–¹æ³•ã€‚

PB04 ç”¨äºé€‰æ‹©ä½¿ç”¨å†…ç½®å¤©çº¿è¿˜æ˜¯å¤–ç½®å¤©çº¿ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨éœ€è¦å°† PB05 è®¾ç½®ä¸ºé«˜ç”µå¹³ä»¥å¼€å¯æ­¤åŠŸèƒ½ã€‚å¦‚æœ PB04 è®¾ç½®ä¸ºä½ç”µå¹³ï¼Œåˆ™ä½¿ç”¨å†…ç½®å¤©çº¿ï¼›å¦‚æœè®¾ç½®ä¸ºé«˜ç”µå¹³ï¼Œåˆ™ä½¿ç”¨å¤–ç½®å¤©çº¿ã€‚é»˜è®¤ä¸ºä½ç”µå¹³ã€‚å¦‚æœæ‚¨æƒ³å°†å…¶è®¾ç½®ä¸ºé«˜ç”µå¹³ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ã€‚
```cpp
#define RF_SW_PW_PIN PB5
#define RF_SW_PIN PB4

void setup() {
  // turn on this antenna function
  pinMode(RF_SW_PW_PIN, OUTPUT);  
  digitalWrite(RF_SW_PW_PIN, HIGH);

  delay(100);

  // HIGH -> Use external antenna / LOW -> Use built-in antenna
  pinMode(RF_SW_PIN, OUTPUT);  
  digitalWrite(RF_SW_PIN, HIGH);
```

## è“ç‰™ä½åŠŸè€— (BLE) ä½¿ç”¨

è“ç‰™ä½åŠŸè€—ï¼Œç®€ç§° BLEï¼Œæ˜¯è“ç‰™çš„ä¸€ç§èŠ‚èƒ½å˜ä½“ã€‚BLE çš„ä¸»è¦åº”ç”¨æ˜¯å°æ•°æ®é‡çš„çŸ­è·ç¦»ä¼ è¾“ï¼ˆä½å¸¦å®½ï¼‰ã€‚ä¸å§‹ç»ˆå¼€å¯çš„è“ç‰™ä¸åŒï¼ŒBLE é™¤äº†åœ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå…¶ä½™æ—¶é—´éƒ½ä¿æŒåœ¨ç¡çœ æ¨¡å¼ã€‚

ç”±äºå…¶ç‰¹æ€§ï¼ŒBLE é€‚ç”¨äºéœ€è¦å®šæœŸäº¤æ¢å°‘é‡æ•°æ®å¹¶ä½¿ç”¨çº½æ‰£ç”µæ± è¿è¡Œçš„åº”ç”¨ã€‚ä¾‹å¦‚ï¼ŒBLE åœ¨åŒ»ç–—ä¿å¥ã€å¥èº«ã€è·Ÿè¸ªã€ä¿¡æ ‡ã€å®‰å…¨å’Œå®¶åº­è‡ªåŠ¨åŒ–è¡Œä¸šä¸­éå¸¸æœ‰ç”¨ã€‚

è¿™ä½¿å¾—å®ƒçš„åŠŸè€—éå¸¸ä½ã€‚BLE çš„åŠŸè€—å¤§çº¦æ¯”è“ç‰™ä½ 100 å€ï¼ˆå–å†³äºä½¿ç”¨æƒ…å†µï¼‰ã€‚

å…³äº XIAO MG24 çš„ BLE éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åœ¨ä»¥ä¸‹ç« èŠ‚ä¸­ä»‹ç»å…¶ä½¿ç”¨æ–¹æ³•ã€‚

- [ä¸€äº›åŸºæœ¬æ¦‚å¿µ](#some-fundamental-concepts) -- æˆ‘ä»¬å°†é¦–å…ˆäº†è§£ä¸€äº›åœ¨ BLE ä¸­å¯èƒ½ç»å¸¸ä½¿ç”¨çš„æ¦‚å¿µï¼Œä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£ BLE ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹å’Œæ€è·¯ã€‚
- [BLE æ‰«æå™¨](#ble-scanner) -- æœ¬èŠ‚å°†è§£é‡Šå¦‚ä½•æœç´¢é™„è¿‘çš„è“ç‰™è®¾å¤‡å¹¶åœ¨ä¸²è¡Œç›‘è§†å™¨ä¸­æ‰“å°å‡ºæ¥ã€‚
- [BLE æœåŠ¡å™¨/å®¢æˆ·ç«¯](#ble-serverclient) -- æœ¬èŠ‚å°†è§£é‡Šå¦‚ä½•ä½¿ç”¨ XIAO MG24 ä½œä¸ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¥å‘é€å’Œæ¥æ”¶æŒ‡å®šçš„æ•°æ®æ¶ˆæ¯ã€‚å®ƒè¿˜å°†ç”¨äºä»æ‰‹æœºæ¥æ”¶æˆ–å‘ XIAO å‘é€æ¶ˆæ¯ã€‚
<!-- - [BLE ä¼ æ„Ÿå™¨æ•°æ®äº¤æ¢](#ble-sensor-data-exchange) -- è¿™æ˜¯å®Œæ•´æ•™ç¨‹çš„æœ€åä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªä¼ æ„Ÿå™¨ç¤ºä¾‹æ¥è§£é‡Šå¦‚ä½•é€šè¿‡ BLE å‘é€ä¼ æ„Ÿå™¨æ•°æ®ã€‚ -->

### ä¸€äº›åŸºæœ¬æ¦‚å¿µ

#### æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯

åœ¨è“ç‰™ä½åŠŸè€—ä¸­ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„è®¾å¤‡ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚XIAO MG24 å¯ä»¥å……å½“å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ã€‚

æœåŠ¡å™¨å¹¿æ’­å…¶å­˜åœ¨ï¼Œä»¥ä¾¿å…¶ä»–è®¾å¤‡å¯ä»¥æ‰¾åˆ°å®ƒï¼Œå¹¶åŒ…å«å®¢æˆ·ç«¯å¯ä»¥è¯»å–çš„æ•°æ®ã€‚å®¢æˆ·ç«¯æ‰«æé™„è¿‘çš„è®¾å¤‡ï¼Œå½“å®ƒæ‰¾åˆ°æ­£åœ¨å¯»æ‰¾çš„æœåŠ¡å™¨æ—¶ï¼Œå®ƒå»ºç«‹è¿æ¥å¹¶ç›‘å¬ä¼ å…¥çš„æ•°æ®ã€‚è¿™ç§°ä¸ºç‚¹å¯¹ç‚¹é€šä¿¡ã€‚

<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/ble.png" style={{width:800, height:'auto'}}/></div>

#### å±æ€§

å±æ€§å®é™…ä¸Šæ˜¯ä¸€æ®µæ•°æ®ã€‚æ¯ä¸ªè“ç‰™è®¾å¤‡éƒ½ç”¨äºæä¾›æœåŠ¡ï¼ŒæœåŠ¡æ˜¯æ•°æ®çš„é›†åˆï¼Œè¯¥é›†åˆå¯ä»¥ç§°ä¸ºæ•°æ®åº“ï¼Œæ•°æ®åº“ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½æ˜¯ä¸€ä¸ªå±æ€§ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å°†å±æ€§ç¿»è¯‘ä¸ºæ•°æ®æ¡ç›®ã€‚æ‚¨å¯ä»¥å°†è“ç‰™è®¾å¤‡æƒ³è±¡ä¸ºä¸€ä¸ªè¡¨æ ¼ï¼Œè¡¨æ ¼å†…çš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªå±æ€§ã€‚

<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/52.png" style={{width:600, height:'auto'}}/></div>

#### GATT

å½“ä¸¤ä¸ªè“ç‰™è®¾å¤‡å»ºç«‹è¿æ¥æ—¶ï¼Œå®ƒä»¬éœ€è¦ä¸€ä¸ªåè®®æ¥ç¡®å®šå¦‚ä½•é€šä¿¡ã€‚GATTï¼ˆé€šç”¨å±æ€§é…ç½®æ–‡ä»¶ï¼‰å°±æ˜¯è¿™æ ·ä¸€ä¸ªåè®®ï¼Œå®ƒå®šä¹‰äº†è“ç‰™è®¾å¤‡ä¹‹é—´å¦‚ä½•ä¼ è¾“æ•°æ®ã€‚

åœ¨ GATT åè®®ä¸­ï¼Œè®¾å¤‡çš„åŠŸèƒ½å’Œå±æ€§è¢«ç»„ç»‡æˆç§°ä¸ºæœåŠ¡ã€ç‰¹å¾å’Œæè¿°ç¬¦çš„ç»“æ„ã€‚æœåŠ¡ä»£è¡¨è®¾å¤‡æä¾›çš„ä¸€ç»„ç›¸å…³åŠŸèƒ½å’Œç‰¹æ€§ã€‚æ¯ä¸ªæœåŠ¡å¯ä»¥åŒ…å«å¤šä¸ªç‰¹å¾ï¼Œè¿™äº›ç‰¹å¾å®šä¹‰äº†æœåŠ¡çš„æŸç§å±æ€§æˆ–è¡Œä¸ºï¼Œä¾‹å¦‚ä¼ æ„Ÿå™¨æ•°æ®æˆ–æ§åˆ¶å‘½ä»¤ã€‚æ¯ä¸ªç‰¹å¾éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å’Œä¸€ä¸ªå€¼ï¼Œå¯ä»¥è¯»å–æˆ–å†™å…¥ä»¥è¿›è¡Œé€šä¿¡ã€‚æè¿°ç¬¦ç”¨äºæè¿°ç‰¹å¾çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚ç‰¹å¾å€¼çš„æ ¼å¼å’Œè®¿é—®æƒé™ã€‚

é€šè¿‡ä½¿ç”¨ GATT åè®®ï¼Œè“ç‰™è®¾å¤‡å¯ä»¥åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸­è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚ä¼ è¾“ä¼ æ„Ÿå™¨æ•°æ®æˆ–æ§åˆ¶è¿œç¨‹è®¾å¤‡ã€‚

#### BLE ç‰¹å¾

ATTï¼Œå…¨åå±æ€§åè®®ã€‚æœ€ç»ˆï¼ŒATT ç”±ä¸€ç»„ ATT å‘½ä»¤ç»„æˆï¼Œå³è¯·æ±‚å’Œå“åº”å‘½ä»¤ï¼ŒATT ä¹Ÿæ˜¯è“ç‰™ç©ºåŒ…çš„æœ€ä¸Šå±‚ï¼Œå³ ATT æ˜¯æˆ‘ä»¬åˆ†æè“ç‰™åŒ…æœ€å¤šçš„åœ°æ–¹ã€‚

ATT å‘½ä»¤ï¼Œæ­£å¼åç§°ä¸º ATT PDUï¼ˆåè®®æ•°æ®å•å…ƒï¼‰ã€‚å®ƒåŒ…æ‹¬ 4 ä¸ªç±»åˆ«ï¼šè¯»å–ã€å†™å…¥ã€é€šçŸ¥å’ŒæŒ‡ç¤ºã€‚è¿™äº›å‘½ä»¤å¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šå¦‚æœéœ€è¦å“åº”ï¼Œåˆ™åé¢ä¼šè·Ÿä¸€ä¸ªè¯·æ±‚ï¼›ç›¸åï¼Œå¦‚æœåªéœ€è¦ ACK è€Œä¸éœ€è¦å“åº”ï¼Œåˆ™åé¢ä¸ä¼šè·Ÿè¯·æ±‚ã€‚

æœåŠ¡å’Œç‰¹å¾åœ¨ GATT å±‚ä¸­å®šä¹‰ã€‚æœåŠ¡ç«¯æä¾›æœåŠ¡ï¼ŒæœåŠ¡å°±æ˜¯æ•°æ®ï¼Œæ•°æ®å°±æ˜¯å±æ€§ï¼ŒæœåŠ¡å’Œç‰¹å¾æ˜¯æ•°æ®çš„é€»è¾‘è¡¨ç¤ºï¼Œæˆ–è€…è¯´ç”¨æˆ·å¯ä»¥çœ‹åˆ°çš„æ•°æ®æœ€ç»ˆéƒ½è½¬æ¢ä¸ºæœåŠ¡å’Œç‰¹å¾ã€‚

è®©æˆ‘ä»¬ä»ç§»åŠ¨è®¾å¤‡çš„è§’åº¦æ¥çœ‹çœ‹æœåŠ¡å’Œç‰¹å¾æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚nRF Connect æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒéå¸¸ç›´è§‚åœ°å‘æˆ‘ä»¬å±•ç¤ºäº†æ¯ä¸ªæ•°æ®åŒ…åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ã€‚

<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/62.png" style={{width:400, height:'auto'}}/></div>

å¦‚æ‚¨æ‰€è§ï¼Œåœ¨è“ç‰™è§„èŒƒä¸­ï¼Œæ¯ä¸ªç‰¹å®šçš„è“ç‰™åº”ç”¨éƒ½ç”±å¤šä¸ªæœåŠ¡ç»„æˆï¼Œæ¯ä¸ªæœåŠ¡ç”±å¤šä¸ªç‰¹å¾ç»„æˆã€‚ç‰¹å¾ç”± UUIDã€å±æ€§å’Œå€¼ç»„æˆã€‚

<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/50.png" style={{width:300, height:'auto'}}/></div>

å±æ€§ç”¨äºæè¿°å¯¹ç‰¹å¾è¿›è¡Œæ“ä½œçš„ç±»å‹å’Œæƒé™ï¼Œä¾‹å¦‚æ˜¯å¦æ”¯æŒè¯»å–ã€å†™å…¥ã€é€šçŸ¥ç­‰ã€‚è¿™ç±»ä¼¼äº ATT PDU ä¸­åŒ…å«çš„å››ä¸ªç±»åˆ«ã€‚

<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/51.png" style={{width:800, height:'auto'}}/></div>

#### UUID

æ¯ä¸ªæœåŠ¡ã€ç‰¹å¾å’Œæè¿°ç¬¦éƒ½æœ‰ä¸€ä¸ª UUIDï¼ˆé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰ã€‚UUID æ˜¯ä¸€ä¸ªå”¯ä¸€çš„ 128 ä½ï¼ˆ16 å­—èŠ‚ï¼‰æ•°å­—ã€‚ä¾‹å¦‚ï¼š

```
ea094cbd-3695-4205-b32d-70c1dea93c35
```

å¯¹äº[SIGï¼ˆè“ç‰™ç‰¹æ®Šå…´è¶£å°ç»„ï¼‰](https://www.bluetooth.com/specifications/gatt/services)ä¸­æŒ‡å®šçš„æ‰€æœ‰ç±»å‹ã€æœåŠ¡å’Œé…ç½®æ–‡ä»¶ï¼Œéƒ½æœ‰ç¼©çŸ­çš„UUIDã€‚ä½†å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦è‡ªå·±çš„UUIDï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ª[UUIDç”Ÿæˆå™¨ç½‘ç«™](https://www.uuidgenerator.net/)æ¥ç”Ÿæˆå®ƒã€‚

### BLEæ‰«æå™¨

åˆ›å»ºä¸€ä¸ªXIAO MG24 BLEæ‰«æå™¨å¾ˆç®€å•ã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºæ‰«æå™¨çš„ç¤ºä¾‹ç¨‹åºã€‚

```cpp
/*
   BLE scan example

   The example scans for other BLE devices and prints out the address, RSSI, channel and name for each found device.

   Find out more on the Silabs BLE API usage at: https://docs.silabs.com/bluetooth/latest/bluetooth-stack-api/

   This example only works with the 'BLE (Silabs)' protocol stack variant.

   Compatible boards:
   - Arduino Nano Matter
   - SparkFun Thing Plus MGM240P
   - xG27 DevKit
   - xG24 Explorer Kit
   - xG24 Dev Kit
   - BGM220 Explorer Kit
   - Ezurio Lyra 24P 20dBm Dev Kit
   - Seeed Studio XIAO MG24 (Sense)

   Author: Tamas Jozsi (Silicon Labs)
 */
#define RF_SW_PW_PIN PB5
#define RF_SW_PIN PB4

void setup() {
  Serial.begin(115200);
}

void loop() {
  
}

static String get_complete_local_name_from_ble_advertisement(sl_bt_evt_scanner_legacy_advertisement_report_t* response);

/**************************************************************************/ /**
 * Bluetooth stack event handler
 * Called when an event happens on BLE the stack
 *
 * @param[in] evt Event coming from the Bluetooth stack
 *****************************************************************************/
void sl_bt_on_event(sl_bt_msg_t* evt) {
  static uint32_t scan_report_num = 0u;
  sl_status_t sc;

  switch (SL_BT_MSG_ID(evt->header)) {
    // This event is received when the BLE device has successfully booted
    case sl_bt_evt_system_boot_id:
      // Print a welcome message
      Serial.begin(115200);

      // turn on this antenna function
      pinMode(RF_SW_PW_PIN, OUTPUT); 
      digitalWrite(RF_SW_PW_PIN, HIGH);

      delay(100);
      // HIGH -> Use external antenna / LOW -> Use built-in antenna
      pinMode(RF_SW_PIN, OUTPUT); 
      digitalWrite(RF_SW_PIN, HIGH);

      Serial.println();
      Serial.println("Silicon Labs BLE scan example");
      Serial.println("BLE stack booted");
      // Start scanning for other BLE devices
      sc = sl_bt_scanner_set_parameters(sl_bt_scanner_scan_mode_active,  // mode
                                        16,                              // interval (value * 0.625 ms)
                                        16);                             // window (value * 0.625 ms)
      app_assert_status(sc);
      sc = sl_bt_scanner_start(sl_bt_scanner_scan_phy_1m,
                               sl_bt_scanner_discover_generic);
      app_assert_status(sc);
      Serial.println("Started scanning...");
      break;

    // This event is received when we scan the advertisement of another BLE device
    case sl_bt_evt_scanner_legacy_advertisement_report_id:
      scan_report_num++;
      Serial.print(" -> #");
      Serial.print(scan_report_num);
      Serial.print(" | Address: ");
      for (int i = 5; i >= 0; i--) {
        Serial.printf("%02x", evt->data.evt_scanner_legacy_advertisement_report.address.addr[i]);
        if (i > 0) {
          Serial.print(":");
        }
      }
      Serial.print(" | RSSI: ");
      Serial.print(evt->data.evt_scanner_legacy_advertisement_report.rssi);
      Serial.print(" dBm");
      Serial.print(" | Channel: ");
      Serial.print(evt->data.evt_scanner_legacy_advertisement_report.channel);
      Serial.print(" | Name: ");
      Serial.println(get_complete_local_name_from_ble_advertisement(&(evt->data.evt_scanner_legacy_advertisement_report)));
      break;

    // Default event handler
    default:
      Serial.print("BLE event: 0x");
      Serial.println(SL_BT_MSG_ID(evt->header), HEX);
      break;
  }
}

/**************************************************************************/ /**
 * Finds the complete local name in BLE advertisements
 *
 * @param[in] response BLE response event received from scanning
 *
 * @return The complete local name if found, "N/A" otherwise
 *****************************************************************************/
static String get_complete_local_name_from_ble_advertisement(sl_bt_evt_scanner_legacy_advertisement_report_t* response) {
  int i = 0;
  // Go through the response data
  while (i < (response->data.len - 1)) {
    uint8_t advertisement_length = response->data.data[i];
    uint8_t advertisement_type = response->data.data[i + 1];

    // If the length exceeds the maximum possible device name length
    if (advertisement_length > 29) {
      continue;
    }

    // Type 0x09 = Complete Local Name, 0x08 Shortened Name
    // If the field type matches the Complete Local Name
    if (advertisement_type == 0x09) {
      // Copy the device name
      char device_name[advertisement_length + 1];
      memcpy(device_name, response->data.data + i + 2, advertisement_length);
      device_name[advertisement_length] = '\0';
      return String(device_name);
    }
    // Jump to next advertisement record
    i = i + advertisement_length + 1;
  }
  return "N/A";
}

#ifndef BLE_STACK_SILABS
#error "This example is only compatible with the Silicon Labs BLE stack. Please select 'BLE (Silabs)' in 'Tools > Protocol stack'."
#endif
```

:::tip
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç¼–è¯‘ä¹‹å‰éœ€è¦åœ¨"å·¥å…· > åè®®æ ˆ"ä¸­é€‰æ‹©"BLE (Silabs)"ã€‚
<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/tool_select.png" style={{width:800, height:'auto'}}/></div>
:::

ç°åœ¨æ‚¨å¯ä»¥é€‰æ‹© XIAO MG24 ä¸»æ¿å¹¶ä¸Šä¼ ç¨‹åºã€‚å¦‚æœç¨‹åºè¿è¡Œé¡ºåˆ©ï¼Œæ‰“å¼€ä¸²å£ç›‘è§†å™¨å¹¶å°†æ³¢ç‰¹ç‡è®¾ç½®ä¸º 115200ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä»¥ä¸‹ç»“æœã€‚

<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/scan_result.png" style={{width:700, height:'auto'}}/></div>

è¯¥ç¨‹åºæ‰“å°å‡ºæ‰«æåˆ°çš„è“ç‰™è®¾å¤‡çš„åç§°ã€MAC åœ°å€ã€ä¿¡é“å’Œä¿¡å·å¼ºåº¦ã€‚

#### ç¨‹åºæ³¨é‡Š

æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Silicon Labs BLE åè®®æ ˆæ‰«æé™„è¿‘çš„ä½åŠŸè€—è“ç‰™ (BLE) è®¾å¤‡ï¼Œæ‰“å°æ¯ä¸ªå‘ç°è®¾å¤‡çš„åœ°å€ã€RSSIï¼ˆæ¥æ”¶ä¿¡å·å¼ºåº¦æŒ‡ç¤ºå™¨ï¼‰ã€ä¿¡é“å’Œåç§°ã€‚

ä»£ç é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•° `sl_bt_on_event`ï¼Œè¯¥å‡½æ•°å¤„ç† BLE åè®®æ ˆç”Ÿæˆçš„å„ç§ä½åŠŸè€—è“ç‰™ (BLE) äº‹ä»¶ã€‚æ­¤å‡½æ•°ä½¿ç”¨ switch è¯­å¥æ¥åŒºåˆ†äº‹ä»¶ç±»å‹ï¼Œä¾‹å¦‚ BLE è®¾å¤‡å¯åŠ¨æ—¶å’Œä»é™„è¿‘è®¾å¤‡æ¥æ”¶å¹¿æ’­æŠ¥å‘Šæ—¶ã€‚æ”¶åˆ°å¯åŠ¨äº‹ä»¶åï¼Œå®ƒåˆå§‹åŒ–ä¸²è¡Œé€šä¿¡ï¼Œé…ç½®ç”¨äºå¤©çº¿æ§åˆ¶çš„ GPIO å¼•è„šï¼Œå¹¶å¼€å§‹ä½¿ç”¨æŒ‡å®šå‚æ•°æ‰«æ BLE è®¾å¤‡ã€‚

å½“æ‰«æè¿‡ç¨‹æ£€æµ‹åˆ°æ¥è‡ª BLE è®¾å¤‡çš„å¹¿æ’­æŠ¥å‘Šæ—¶ï¼Œä¼šè§¦å‘ `sl_bt_evt_scanner_legacy_advertisement_report_id` åˆ†æ”¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¸ºæ¯ä¸ªæ£€æµ‹åˆ°çš„è®¾å¤‡é€’å¢è®¡æ•°å™¨ï¼Œå¹¶æå–å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¾å¤‡çš„åœ°å€ã€RSSIã€ä¿¡é“å’Œæœ¬åœ°åç§°ã€‚å®ƒåˆ©ç”¨è¾…åŠ©å‡½æ•° `get_complete_local_name_from_ble_advertisement` ä»å¹¿æ’­æ•°æ®ä¸­æ£€ç´¢è®¾å¤‡çš„å®Œæ•´åç§°ï¼Œç„¶åå°†å…¶æ‰“å°åˆ°ä¸²è¡Œè¾“å‡ºã€‚

è¾…åŠ©å‡½æ•° `get_complete_local_name_from_ble_advertisement` éå†å¹¿æ’­æ•°æ®ä»¥å®šä½å®Œæ•´æœ¬åœ°åç§°å­—æ®µã€‚å®ƒæ£€æŸ¥æ¯ä¸ªå¹¿æ’­è®°å½•çš„ç±»å‹æ˜¯å¦å¯¹åº”äºå®Œæ•´æœ¬åœ°åç§°ï¼Œå¹¶å°†å…¶ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚å¦‚æœæœªæ‰¾åˆ°å®Œæ•´åç§°ï¼Œå‡½æ•°è¿”å›"N/A"ã€‚è¿™ç§ç³»ç»ŸåŒ–æ–¹æ³•å…è®¸åº”ç”¨ç¨‹åºæœ‰æ•ˆåœ°å‘ç°å’Œè¯†åˆ«é™„è¿‘çš„ BLE è®¾å¤‡ï¼Œåœ¨æ‰«æè¿‡ç¨‹ä¸­æä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚

### BLE æœåŠ¡å™¨/å®¢æˆ·ç«¯

å¦‚å‰æ‰€è¿°ï¼ŒXIAO MG24 å¯ä»¥åŒæ—¶å……å½“æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä½œä¸ºæœåŠ¡å™¨çš„ç¨‹åºä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚å°†ä»¥ä¸‹ç¨‹åºä¸Šä¼ åˆ° XIAO åï¼Œå®ƒå°†å……å½“æœåŠ¡å™¨å¹¶å‘è¿æ¥åˆ° XIAO çš„æ‰€æœ‰è“ç‰™è®¾å¤‡å‘é€"Hello World"æ¶ˆæ¯ã€‚

```cpp
//Server Code
#define RF_SW_PW_PIN PB5
#define RF_SW_PIN PB4

bool notification_enabled = false;

void setup() {
  pinMode(LED_BUILTIN, OUTPUT);
  digitalWrite(LED_BUILTIN, LED_BUILTIN_INACTIVE);
  Serial.begin(115200);
  Serial.println("Silicon Labs BLE send hello world example");

  // turn on the antenna function
  pinMode(RF_SW_PW_PIN, OUTPUT);
  digitalWrite(RF_SW_PW_PIN, HIGH);

  delay(100);

  // HIGH -> Use external antenna / LOW -> Use built-in antenna
  pinMode(RF_SW_PIN, OUTPUT);
  digitalWrite(RF_SW_PIN, LOW);
}

void loop() {
  if (notification_enabled) {
    // Send a notification every two seconds with the message 'hello world'
    send_helloworld_notification();
  }
  delay(2000);
}

static void ble_initialize_gatt_db();
static void ble_start_advertising();

static const uint8_t advertised_name[] = "XIAO_MG24 Server";  // Name of your BLE device
static uint16_t gattdb_session_id;
static uint16_t generic_access_service_handle;
static uint16_t name_characteristic_handle;
static uint16_t my_service_handle;
static uint16_t led_control_characteristic_handle;
static uint16_t notify_characteristic_handle;

/**************************************************************************/ /**
 * Bluetooth stack event handler
 * Called when an event happens on BLE the stack
 *
 * @param[in] evt Event coming from the Bluetooth stack
 *****************************************************************************/
void sl_bt_on_event(sl_bt_msg_t *evt) {
  switch (SL_BT_MSG_ID(evt->header)) {
    // -------------------------------
    // This event indicates the device has started and the radio is ready.
    // Do not call any stack command before receiving this boot event!
    case sl_bt_evt_system_boot_id:
      {
        Serial.println("BLE stack booted");

        // Initialize the application specific GATT table
        ble_initialize_gatt_db();

        // Start advertising
        ble_start_advertising();
        Serial.println("BLE advertisement started");
      }
      break;

    // -------------------------------
    // This event indicates that a new connection was opened
    case sl_bt_evt_connection_opened_id:
      Serial.println("BLE connection opened");
      break;

    // -------------------------------
    // This event indicates that a connection was closed
    case sl_bt_evt_connection_closed_id:
      Serial.println("BLE connection closed");
      // Restart the advertisement
      ble_start_advertising();
      Serial.println("BLE advertisement restarted");
      break;

    // -------------------------------
    // This event indicates that the value of an attribute in the local GATT
    // database was changed by a remote GATT client
    case sl_bt_evt_gatt_server_attribute_value_id:
      // Check if the changed characteristic is the LED control
      if (led_control_characteristic_handle == evt->data.evt_gatt_server_attribute_value.attribute) {
        Serial.println("LED control characteristic data received");
        // Check the length of the received data
        if (evt->data.evt_gatt_server_attribute_value.value.len == 0) {
          break;
        }
        // Get the received byte
        uint8_t received_data = evt->data.evt_gatt_server_attribute_value.value.data[0];
        // Turn the LED on/off according to the received data
        // If we receive a '0' - turn the LED off
        // If we receive a '1' - turn the LED on
        if (received_data == 0x00) {
          digitalWrite(LED_BUILTIN, LED_BUILTIN_INACTIVE);
          Serial.println("LED off");
        } else if (received_data == 0x01) {
          Serial.println("LED on");
          digitalWrite(LED_BUILTIN, LED_BUILTIN_ACTIVE);
        }
      }
      break;

    // -------------------------------
    // This event is received when a GATT characteristic status changes
    case sl_bt_evt_gatt_server_characteristic_status_id:
      // If the 'Notify' characteristic has been changed
      if (evt->data.evt_gatt_server_characteristic_status.characteristic == notify_characteristic_handle) {
        // The client just enabled the notification - send notification of the current state
        if (evt->data.evt_gatt_server_characteristic_status.client_config_flags & sl_bt_gatt_notification) {
          Serial.println("change notification enabled");
          notification_enabled = true;
        } else {
          Serial.println("change notification disabled");
          notification_enabled = false;
        }
      }
      break;

    // -------------------------------
    // Default event handler
    default:
      break;
  }
}

/**************************************************************************/ /**
 * Sends a BLE notification the the client if notifications are enabled 
 *****************************************************************************/
static void send_helloworld_notification() {
  uint8_t str[12] = "Hello World";
  sl_status_t sc = sl_bt_gatt_server_notify_all(notify_characteristic_handle,
                                                sizeof(str),
                                                (const uint8_t *)&str);
  if (sc == SL_STATUS_OK) {
    Serial.println("Send notification!");
  }
}

/**************************************************************************/ /**
 * Starts BLE advertisement
 * Initializes advertising if it's called for the first time
 *****************************************************************************/
static void ble_start_advertising() {
  static uint8_t advertising_set_handle = 0xff;
  static bool init = true;
  sl_status_t sc;

  if (init) {
    // Create an advertising set
    sc = sl_bt_advertiser_create_set(&advertising_set_handle);
    app_assert_status(sc);

    // Set advertising interval to 100ms
    sc = sl_bt_advertiser_set_timing(
      advertising_set_handle,
      160,  // minimum advertisement interval (milliseconds * 1.6)
      160,  // maximum advertisement interval (milliseconds * 1.6)
      0,    // advertisement duration
      0);   // maximum number of advertisement events
    app_assert_status(sc);

    init = false;
  }

  // Generate data for advertising
  sc = sl_bt_legacy_advertiser_generate_data(advertising_set_handle, sl_bt_advertiser_general_discoverable);
  app_assert_status(sc);

  // Start advertising and enable connections
  sc = sl_bt_legacy_advertiser_start(advertising_set_handle, sl_bt_advertiser_connectable_scannable);
  app_assert_status(sc);
}

/**************************************************************************/ /**
 * Initializes the GATT database
 * Creates a new GATT session and adds certain services and characteristics
 *****************************************************************************/
static void ble_initialize_gatt_db() {
  sl_status_t sc;
  // Create a new GATT database
  sc = sl_bt_gattdb_new_session(&gattdb_session_id);
  app_assert_status(sc);

  // Add the Generic Access service to the GATT DB
  const uint8_t generic_access_service_uuid[] = { 0x00, 0x18 };
  sc = sl_bt_gattdb_add_service(gattdb_session_id,
                                sl_bt_gattdb_primary_service,
                                SL_BT_GATTDB_ADVERTISED_SERVICE,
                                sizeof(generic_access_service_uuid),
                                generic_access_service_uuid,
                                &generic_access_service_handle);
  app_assert_status(sc);

  // Add the Device Name characteristic to the Generic Access service
  // The value of the Device Name characteristic will be advertised
  const sl_bt_uuid_16_t device_name_characteristic_uuid = { .data = { 0x00, 0x2A } };
  sc = sl_bt_gattdb_add_uuid16_characteristic(gattdb_session_id,
                                              generic_access_service_handle,
                                              SL_BT_GATTDB_CHARACTERISTIC_READ,
                                              0x00,
                                              0x00,
                                              device_name_characteristic_uuid,
                                              sl_bt_gattdb_fixed_length_value,
                                              sizeof(advertised_name) - 1,
                                              sizeof(advertised_name) - 1,
                                              advertised_name,
                                              &name_characteristic_handle);
  app_assert_status(sc);

  // Start the Generic Access service
  sc = sl_bt_gattdb_start_service(gattdb_session_id, generic_access_service_handle);
  app_assert_status(sc);

  // Add my BLE service to the GATT DB
  // UUID: de8a5aac-a99b-c315-0c80-60d4cbb51224
  const uuid_128 my_service_uuid = {
    .data = { 0x24, 0x12, 0xb5, 0xcb, 0xd4, 0x60, 0x80, 0x0c, 0x15, 0xc3, 0x9b, 0xa9, 0xac, 0x5a, 0x8a, 0xde }
  };
  sc = sl_bt_gattdb_add_service(gattdb_session_id,
                                sl_bt_gattdb_primary_service,
                                SL_BT_GATTDB_ADVERTISED_SERVICE,
                                sizeof(my_service_uuid),
                                my_service_uuid.data,
                                &my_service_handle);
  app_assert_status(sc);

  // Add the 'LED Control' characteristic to the Blinky service
  // UUID: 5b026510-4088-c297-46d8-be6c736a087a
  const uuid_128 led_control_characteristic_uuid = {
    .data = { 0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b }
  };
  uint8_t led_char_init_value = 0;
  sc = sl_bt_gattdb_add_uuid128_characteristic(gattdb_session_id,
                                               my_service_handle,
                                               SL_BT_GATTDB_CHARACTERISTIC_READ | SL_BT_GATTDB_CHARACTERISTIC_WRITE,
                                               0x00,
                                               0x00,
                                               led_control_characteristic_uuid,
                                               sl_bt_gattdb_fixed_length_value,
                                               1,                            // max length
                                               sizeof(led_char_init_value),  // initial value length
                                               &led_char_init_value,         // initial value
                                               &led_control_characteristic_handle);

  // Start the Blinky service
  sc = sl_bt_gattdb_start_service(gattdb_session_id, my_service_handle);
  app_assert_status(sc);

  // Add the 'Notify' characteristic to my BLE service
  // UUID: 61a885a4-41c3-60d0-9a53-6d652a70d29c
  const uuid_128 btn_report_characteristic_uuid = {
    .data = { 0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61 }
  };
  uint8_t notify_char_init_value = 0;
  sc = sl_bt_gattdb_add_uuid128_characteristic(gattdb_session_id,
                                               my_service_handle,
                                               SL_BT_GATTDB_CHARACTERISTIC_READ | SL_BT_GATTDB_CHARACTERISTIC_NOTIFY,
                                               0x00,
                                               0x00,
                                               btn_report_characteristic_uuid,
                                               sl_bt_gattdb_fixed_length_value,
                                               1,                               // max length
                                               sizeof(notify_char_init_value),  // initial value length
                                               &notify_char_init_value,         // initial value
                                               &notify_characteristic_handle);

  // Start my BLE service
  sc = sl_bt_gattdb_start_service(gattdb_session_id, my_service_handle);
  app_assert_status(sc);

  // Commit the GATT DB changes
  sc = sl_bt_gattdb_commit(gattdb_session_id);
  app_assert_status(sc);
}

#ifndef BLE_STACK_SILABS
#error "This example is only compatible with the Silicon Labs BLE stack. Please select 'BLE (Silabs)' in 'Tools > Protocol stack'."
#endif
```

åŒæ—¶ï¼Œæ‚¨å¯ä»¥åœ¨ä¸»è¦çš„ç§»åŠ¨åº”ç”¨å•†åº—ä¸­æœç´¢å¹¶ä¸‹è½½ **nRF Connect** åº”ç”¨ï¼Œè¯¥åº”ç”¨å…è®¸æ‚¨çš„æ‰‹æœºæœç´¢å¹¶è¿æ¥åˆ°è“ç‰™è®¾å¤‡ã€‚

- å®‰å“ç³»ç»Ÿï¼š[nRF Connect](https://play.google.com/store/apps/details?id=no.nordicsemi.android.mcp&hl=en)
- IOSï¼š[nRF Connect](https://apps.apple.com/us/app/nrf-connect-for-mobile/id1054362403)

ä¸‹è½½è½¯ä»¶åï¼ŒæŒ‰ç…§ä¸‹é¢æ˜¾ç¤ºçš„æ­¥éª¤æœç´¢å¹¶è¿æ¥ XIAO_MG24ï¼Œæ‚¨å°†çœ‹åˆ°å¹¿æ’­çš„"Hello World"ã€‚

<table align="center">
	<tr>
	    <td><div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/BLEServer-1.jpg" style={{width:200, height:'auto'}}/></div></td>
	    <td><div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/BLEServer-2.jpg" style={{width:200, height:'auto'}}/></div></td>
		<td><div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/BLEServer-3.jpg" style={{width:200, height:'auto'}}/></div></td>
		<td><div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/BLEServer-4.jpg" style={{width:200, height:'auto'}}/></div></td>
	</tr>
</table>


å¦‚æœæ‚¨æƒ³ä½¿ç”¨å¦ä¸€ä¸ª XIAO MG24 ä½œä¸ºå®¢æˆ·ç«¯æ¥æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä¸ºå®¢æˆ·ç«¯ XIAO ä½¿ç”¨ä»¥ä¸‹ç¨‹åºã€‚

```cpp
// Client Code
#define RF_SW_PW_PIN PB5
#define RF_SW_PIN PB4

// Connection states
enum conn_state_t {
  ST_BOOT,
  ST_SCAN,
  ST_CONNECT,
  ST_SERVICE_DISCOVER,
  ST_CHAR_DISCOVER,
  ST_READY
};

conn_state_t connection_state = ST_BOOT;
uint8_t connection_handle = __UINT8_MAX__;
uint32_t blinky_service_handle = __UINT32_MAX__;
uint16_t led_control_char_handle = __UINT16_MAX__;
bool gatt_procedure_in_progress = false;

// If there's no built-in button set a pin where a button is connected
#ifndef BTN_BUILTIN
#define BTN_BUILTIN D0
#endif

void setup() {
  // Set the built-in LED as output
  pinMode(LED_BUILTIN, OUTPUT);
  // Turn the built-in LED off
  digitalWrite(LED_BUILTIN, LED_BUILTIN_INACTIVE);
  // Set the built-in button as input
  pinMode(BTN_BUILTIN, INPUT);
  // Start Serial
  Serial.begin(115200);

  // turn on the antenna function
  pinMode(RF_SW_PW_PIN, OUTPUT);
  digitalWrite(RF_SW_PW_PIN, HIGH);

  delay(100);

  // HIGH -> Use external antenna / LOW -> Use built-in antenna
  pinMode(RF_SW_PIN, OUTPUT);
  digitalWrite(RF_SW_PIN, LOW);
}

void loop() {
  // Static variable for remembering the previous state of the button
  static uint8_t btn_state_prev = LOW;
  // If the connection is fully established and we don't have any ongoing GATT procedures
  if (connection_state == ST_READY && !gatt_procedure_in_progress) {
    // Read the current state of the button
    uint8_t btn_state = digitalRead(BTN_BUILTIN);
    // If the current state is different than the previous state
    if (btn_state_prev != btn_state) {
      // Update the previous state
      btn_state_prev = btn_state;
      // Invert the state (the SL board buttons give a 0 when pressed and 1 when released)
      uint8_t btn_state_inv = !btn_state;
      // Log the state change
      Serial.print("Sending button state: ");
      Serial.println(btn_state_inv);
      // Send the new state over BLE by writing the other device's LED Control characteristic
      sl_status_t sc = sl_bt_gatt_write_characteristic_value(connection_handle, led_control_char_handle, sizeof(uint8_t), &btn_state_inv);
      app_assert_status(sc);
      gatt_procedure_in_progress = true;
    }
  }
}

// Blinky service
// UUID: de8a5aac-a99b-c315-0c80-60d4cbb51224
const uuid_128 blinky_service_uuid = {
  .data = { 0x24, 0x12, 0xb5, 0xcb, 0xd4, 0x60, 0x80, 0x0c, 0x15, 0xc3, 0x9b, 0xa9, 0xac, 0x5a, 0x8a, 0xde }
};

// LED Control characteristic
// UUID: 5b026510-4088-c297-46d8-be6c736a087a
const uuid_128 led_control_characteristic_uuid = {
  .data = { 0x7a, 0x08, 0x6a, 0x73, 0x6c, 0xbe, 0xd8, 0x46, 0x97, 0xc2, 0x88, 0x40, 0x10, 0x65, 0x02, 0x5b }
};
const uint8_t advertised_name[] = "XIAO_MG24 Server";

static bool find_complete_local_name_in_advertisement(sl_bt_evt_scanner_legacy_advertisement_report_t* response);

/**************************************************************************/ /**
 * Bluetooth stack event handler
 * Called when an event happens on BLE the stack
 *
 * @param[in] evt Event coming from the Bluetooth stack
 *****************************************************************************/
void sl_bt_on_event(sl_bt_msg_t* evt) {
  static uint32_t scan_report_num = 0u;
  sl_status_t sc;

  switch (SL_BT_MSG_ID(evt->header)) {
    // This event is received when the BLE device has successfully booted
    case sl_bt_evt_system_boot_id:
      // Print a welcome message
      Serial.println();
      Serial.println("Silicon Labs BLE light switch client example");
      Serial.println("BLE stack booted");
      // Start scanning for other BLE devices
      sc = sl_bt_scanner_set_parameters(sl_bt_scanner_scan_mode_active, 16, 16);
      app_assert_status(sc);
      sc = sl_bt_scanner_start(sl_bt_scanner_scan_phy_1m,
                               sl_bt_scanner_discover_generic);
      app_assert_status(sc);
      Serial.println("Started scanning...");
      connection_state = ST_SCAN;
      break;

    // This event is received when we scan the advertisement of another BLE device
    case sl_bt_evt_scanner_legacy_advertisement_report_id:
      scan_report_num++;
      Serial.print(" -> #");
      Serial.print(scan_report_num);
      Serial.print(" | Address: ");
      for (int i = 5; i >= 0; i--) {
        Serial.printf("%02x", evt->data.evt_scanner_legacy_advertisement_report.address.addr[i]);
        if (i > 0) {
          Serial.print(":");
        }
      }
      Serial.print(" | RSSI: ");
      Serial.print(evt->data.evt_scanner_legacy_advertisement_report.rssi);
      Serial.print(" dBm");
      Serial.print(" | Channel: ");
      Serial.print(evt->data.evt_scanner_legacy_advertisement_report.channel);
      Serial.print(" | Name: ");
      Serial.println(find_complete_local_name_in_advertisement(&(evt->data.evt_scanner_legacy_advertisement_report)));

      // If we find the other devices's name
      if (find_complete_local_name_in_advertisement(&(evt->data.evt_scanner_legacy_advertisement_report))) {
        Serial.println("Target device found!");
        Serial.print("Forming a connection to ");
        for (int i = 5; i >= 0; i--) {
          Serial.printf("%02x", evt->data.evt_scanner_legacy_advertisement_report.address.addr[i]);
          if (i > 0) {
            Serial.print(":");
          }
        }
        Serial.println(" ");

        // Stop scanning
        sc = sl_bt_scanner_stop();
        app_assert_status(sc);
        // Connect to the device
        sc = sl_bt_connection_open(evt->data.evt_scanner_legacy_advertisement_report.address,
                                   evt->data.evt_scanner_legacy_advertisement_report.address_type,
                                   sl_bt_gap_phy_1m,
                                   NULL);
        // app_assert_status(sc);
        connection_state = ST_CONNECT;

        Serial.println("We are now connected to the BLE Server");
      }
      break;

    // This event is received when a BLE connection has been opened
    case sl_bt_evt_connection_opened_id:
      Serial.println("Connection opened");
      digitalWrite(LED_BUILTIN, LED_BUILTIN_ACTIVE);
      connection_handle = evt->data.evt_connection_opened.connection;
      // Discover Health Thermometer service on the connected device
      sc = sl_bt_gatt_discover_primary_services_by_uuid(connection_handle,
                                                        sizeof(blinky_service_uuid),
                                                        blinky_service_uuid.data);
      app_assert_status(sc);
      gatt_procedure_in_progress = true;
      connection_state = ST_SERVICE_DISCOVER;
      break;

    // This event is received when a BLE connection has been closed
    case sl_bt_evt_connection_closed_id:
      Serial.println("Connection closed");
      digitalWrite(LED_BUILTIN, LED_BUILTIN_INACTIVE);
      connection_handle = __UINT8_MAX__;
      // Restart scanning
      sc = sl_bt_scanner_start(sl_bt_scanner_scan_phy_1m,
                               sl_bt_scanner_discover_generic);
      app_assert_status(sc);
      Serial.println("Restarted scanning...");
      connection_state = ST_SCAN;
      break;

    // This event is generated when a new service is discovered
    case sl_bt_evt_gatt_service_id:
      Serial.println("GATT service discovered");
      // Store the handle of the discovered Thermometer Service
      blinky_service_handle = evt->data.evt_gatt_service.service;
      break;

    // This event is generated when a new characteristic is discovered
    case sl_bt_evt_gatt_characteristic_id:
      Serial.println("GATT charactersitic discovered");
      // Store the handle of the discovered Temperature Measurement characteristic
      led_control_char_handle = evt->data.evt_gatt_characteristic.characteristic;
      break;

    // This event is received when a GATT procedure completes
    case sl_bt_evt_gatt_procedure_completed_id:
      Serial.println("GATT procedure completed");
      gatt_procedure_in_progress = false;

      if (connection_state == ST_SERVICE_DISCOVER) {
        Serial.println("GATT service discovery finished");
        // Discover thermometer characteristic on the connected device
        sc = sl_bt_gatt_discover_characteristics_by_uuid(evt->data.evt_gatt_procedure_completed.connection,
                                                         blinky_service_handle,
                                                         sizeof(led_control_characteristic_uuid.data),
                                                         led_control_characteristic_uuid.data);
        app_assert_status(sc);
        gatt_procedure_in_progress = true;
        connection_state = ST_CHAR_DISCOVER;
        break;
      }

      if (connection_state == ST_CHAR_DISCOVER) {
        Serial.println("GATT characteristic discovery finished");
        connection_state = ST_READY;
        break;
      }
      break;

    // Default event handler
    default:
      Serial.print("BLE event: 0x");
      Serial.println(SL_BT_MSG_ID(evt->header), HEX);
      break;
  }
}

/**************************************************************************/ /**
 * Finds a configured name in BLE advertisements
 *
 * @param[in] response BLE response event received from scanning
 *
 * @return true if found, false otherwise
 *****************************************************************************/
static bool find_complete_local_name_in_advertisement(sl_bt_evt_scanner_legacy_advertisement_report_t* response) {
  int i = 0;
  bool found = false;

  // Go through the response data
  while (i < (response->data.len - 1)) {
    uint8_t advertisement_length = response->data.data[i];
    uint8_t advertisement_type = response->data.data[i + 1];

    // Type 0x09 = Complete Local Name, 0x08 Shortened Name
    // If the field type matches the Complete Local Name
    if (advertisement_type == 0x09) {
      // Check if device name matches
      if (memcmp(response->data.data + i + 2, advertised_name, strlen((const char*)advertised_name)) == 0) {
        found = true;
        break;
      }
    }
    // Jump to next advertisement record
    i = i + advertisement_length + 1;
  }
  return found;
}

#ifndef BLE_STACK_SILABS
#error "This example is only compatible with the Silicon Labs BLE stack. Please select 'BLE (Silabs)' in 'Tools > Protocol stack'."
#endif
```

ä¸Šè¿°ç¨‹åºå°†æŠŠ XIAO å˜æˆä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæœç´¢é™„è¿‘çš„è“ç‰™è®¾å¤‡ã€‚å½“è“ç‰™è®¾å¤‡çš„ UUID ä¸æ‚¨æä¾›çš„ UUID åŒ¹é…æ—¶ï¼Œå®ƒå°†è¿æ¥åˆ°è¯¥è®¾å¤‡å¹¶è·å–å…¶ç‰¹å¾å€¼ã€‚


<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/BLEClient_result.png" style={{width:800, height:'auto'}}/></div>


#### ç¨‹åºæ³¨é‡Š

è®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹ BLE æœåŠ¡å™¨ç¤ºä¾‹ä»£ç çš„å·¥ä½œåŸç†ã€‚å®ƒé¦–å…ˆå¯¼å…¥è“ç‰™åŠŸèƒ½æ‰€éœ€çš„åº“ã€‚ç„¶åï¼Œæ‚¨éœ€è¦ä¸ºæœåŠ¡å’Œç‰¹å¾å®šä¹‰ä¸€ä¸ª UUIDã€‚

```c
// Add my BLE service to the GATT DB
// UUID: de8a5aac-a99b-c315-0c80-60d4cbb51224
const uuid_128 my_service_uuid = {
  .data = { 0x24, 0x12, 0xb5, 0xcb, 0xd4, 0x60, 0x80, 0x0c, 0x15, 0xc3, 0x9b, 0xa9, 0xac, 0x5a, 0x8a, 0xde }
};

// Add the 'Notify' characteristic to my BLE service
// UUID: 61a885a4-41c3-60d0-9a53-6d652a70d29c
const uuid_128 btn_report_characteristic_uuid = {
  .data = { 0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61 }
};
```

æ‚¨å¯ä»¥ä¿ç•™é»˜è®¤çš„UUIDï¼Œæˆ–è€…å¯ä»¥è®¿é—® [uuidgenerator.net](https://www.uuidgenerator.net/) ä¸ºæ‚¨çš„æœåŠ¡å’Œç‰¹å¾åˆ›å»ºéšæœºUUIDã€‚

ç„¶åï¼Œæ‚¨åˆ›å»ºä¸€ä¸ªåä¸º"XIAO_MG24 Server"çš„BLEè®¾å¤‡ã€‚æ‚¨å¯ä»¥å°†æ­¤åç§°æ›´æ”¹ä¸ºä»»ä½•æ‚¨å–œæ¬¢çš„åç§°ã€‚åœ¨ä¸‹ä¸€è¡Œä¸­ï¼Œæ‚¨å°†BLEè®¾å¤‡è®¾ç½®ä¸ºæœåŠ¡å™¨ã€‚ä¹‹åï¼Œæ‚¨ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„UUIDä¸ºBLEæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªæœåŠ¡ã€‚

```c
sl_status_t sc;
// Create a new GATT database
sc = sl_bt_gattdb_new_session(&gattdb_session_id);
app_assert_status(sc);

// Add the Generic Access service to the GATT DB
const uint8_t generic_access_service_uuid[] = { 0x00, 0x18 };
sc = sl_bt_gattdb_add_service(gattdb_session_id,
                              sl_bt_gattdb_primary_service,
                              SL_BT_GATTDB_ADVERTISED_SERVICE,
                              sizeof(generic_access_service_uuid),
                              generic_access_service_uuid,
                              &generic_access_service_handle);
app_assert_status(sc);

// Add the Device Name characteristic to the Generic Access service
// The value of the Device Name characteristic will be advertised
const sl_bt_uuid_16_t device_name_characteristic_uuid = { .data = { 0x00, 0x2A } };
sc = sl_bt_gattdb_add_uuid16_characteristic(gattdb_session_id,
                                            generic_access_service_handle,
                                            SL_BT_GATTDB_CHARACTERISTIC_READ,
                                            0x00,
                                            0x00,
                                            device_name_characteristic_uuid,
                                            sl_bt_gattdb_fixed_length_value,
                                            sizeof(advertised_name) - 1,
                                            sizeof(advertised_name) - 1,
                                            advertised_name,
                                            &name_characteristic_handle);
app_assert_status(sc);

// Start the Generic Access service
sc = sl_bt_gattdb_start_service(gattdb_session_id, generic_access_service_handle);
app_assert_status(sc);

// Add my BLE service to the GATT DB
// UUID: de8a5aac-a99b-c315-0c80-60d4cbb51224
const uuid_128 my_service_uuid = {
  .data = { 0x24, 0x12, 0xb5, 0xcb, 0xd4, 0x60, 0x80, 0x0c, 0x15, 0xc3, 0x9b, 0xa9, 0xac, 0x5a, 0x8a, 0xde }
};
sc = sl_bt_gattdb_add_service(gattdb_session_id,
                              sl_bt_gattdb_primary_service,
                              SL_BT_GATTDB_ADVERTISED_SERVICE,
                              sizeof(my_service_uuid),
                              my_service_uuid.data,
                              &my_service_handle);
app_assert_status(sc);
```

ç„¶åï¼Œæ‚¨ä¸ºè¯¥æœåŠ¡è®¾ç½®ç‰¹å¾ã€‚å¦‚æ‚¨æ‰€è§ï¼Œæ‚¨è¿˜ä½¿ç”¨äº†ä¹‹å‰å®šä¹‰çš„ UUIDï¼Œå¹¶ä¸”éœ€è¦å°†ç‰¹å¾çš„å±æ€§ä½œä¸ºå‚æ•°ä¼ é€’ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬æ˜¯ï¼šREAD å’Œ NOTIFYã€‚

```c
// Add the 'Notify' characteristic to my BLE service
// UUID: 61a885a4-41c3-60d0-9a53-6d652a70d29c
const uuid_128 btn_report_characteristic_uuid = {
  .data = { 0x9c, 0xd2, 0x70, 0x2a, 0x65, 0x6d, 0x53, 0x9a, 0xd0, 0x60, 0xc3, 0x41, 0xa4, 0x85, 0xa8, 0x61 }
};
uint8_t notify_char_init_value = 0;
sc = sl_bt_gattdb_add_uuid128_characteristic(gattdb_session_id,
                                              my_service_handle,
                                              SL_BT_GATTDB_CHARACTERISTIC_READ | SL_BT_GATTDB_CHARACTERISTIC_NOTIFY,
                                              0x00,
                                              0x00,
                                              btn_report_characteristic_uuid,
                                              sl_bt_gattdb_fixed_length_value,
                                              1,                               // max length
                                              sizeof(notify_char_init_value),  // initial value length
                                              &notify_char_init_value,         // initial value
                                              &notify_characteristic_handle);

// Start my BLE service
sc = sl_bt_gattdb_start_service(gattdb_session_id, my_service_handle);
app_assert_status(sc);

// Commit the GATT DB changes
sc = sl_bt_gattdb_commit(gattdb_session_id);
app_assert_status(sc);
```

åˆ›å»ºç‰¹å¾åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `sl_bt_gatt_server_notify_all()` æ–¹æ³•è®¾ç½®å…¶å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†å€¼è®¾ç½®ä¸ºæ–‡æœ¬"Hello World"ã€‚æ‚¨å¯ä»¥å°†æ­¤æ–‡æœ¬æ›´æ”¹ä¸ºä»»ä½•æ‚¨å–œæ¬¢çš„å†…å®¹ã€‚åœ¨æœªæ¥çš„é¡¹ç›®ä¸­ï¼Œæ­¤æ–‡æœ¬å¯ä»¥æ˜¯ä¼ æ„Ÿå™¨è¯»æ•°æˆ–ç¯çš„çŠ¶æ€ç­‰ã€‚

æœ€åï¼Œæ‚¨å¯ä»¥å¯åŠ¨æœåŠ¡å’Œå¹¿æ’­ï¼Œä»¥ä¾¿å…¶ä»– BLE è®¾å¤‡å¯ä»¥æ‰«æå¹¶æ‰¾åˆ°æ­¤ BLE è®¾å¤‡ã€‚

```c
// Start advertising
ble_start_advertising();
```

è¿™åªæ˜¯ä¸€ä¸ªå¦‚ä½•åˆ›å»ºBLEæœåŠ¡å™¨çš„ç®€å•ç¤ºä¾‹ã€‚è¯¥ç¨‹åºçš„åŠŸèƒ½æ˜¯æ¯ä¸¤ç§’å‘é€ä¸€æ¬¡é€šçŸ¥ï¼Œå†…å®¹ä¸º"Hello World"ã€‚


### BLEä¼ æ„Ÿå™¨æ•°æ®äº¤æ¢

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›å…¥å®é™…åº”ç”¨æ¥å®Œæˆä¸€ä¸ªæ¡ˆä¾‹ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨XIAO MG24çš„`getCPUTemp()`å‡½æ•°æ¥æµ‹é‡å½“å‰MCUçš„æ¸©åº¦ï¼Œç„¶åé€šè¿‡è“ç‰™å°†MCUçš„æ¸©åº¦å€¼å‘é€åˆ°å¦ä¸€ä¸ªXIAO MG24ï¼Œä»¥æ¨¡æ‹Ÿå¥åº·æ¸©åº¦è®¡ã€‚

æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸¤ä¸ªXIAOï¼Œä¸€ä¸ªä½œä¸ºæœåŠ¡å™¨ï¼Œä¸€ä¸ªä½œä¸ºå®¢æˆ·ç«¯ã€‚ä»¥ä¸‹æ˜¯ä½œä¸ºæœåŠ¡å™¨çš„ç¤ºä¾‹ç¨‹åºã€‚ä½œä¸ºæœåŠ¡å™¨çš„XIAOå…·æœ‰ä»¥ä¸‹ä¸»è¦ä»»åŠ¡ï¼š
- é¦–å…ˆï¼Œä½¿ç”¨`getCPUTemp()`å‡½æ•°è·å–MCUçš„å½“å‰æ¸©åº¦ï¼›
- å…¶æ¬¡ï¼Œåˆ›å»ºè“ç‰™æœåŠ¡å™¨ï¼›
- ç¬¬ä¸‰ï¼Œé€šè¿‡è“ç‰™å¹¿æ’­æ¸©åº¦å€¼ï¼›
- ç¬¬å››ï¼Œæ˜¾ç¤ºå®æ—¶æ¸©åº¦ã€‚

```c
// server

/*
   BLE health thermometer example

   The example implements a minimal BLE Health Thermometer profile to provide temperature measurements over BLE

   On startup the sketch will start a BLE advertisement with the configured name, then
   it will accept any incoming connection. When a device is connected and enables indications for the
   health thermometer characteristic, then the device will send it's CPU temperature readings as thermometer data.
   With the EFR Connect app you can test this functionality by going to the "Demo" tab and selecting "Health Thermometer".
   Alternatively, you can test this example by flashing an other BLE board with the 'ble_health_thermometer_client' demo
   and have the two boards exchange the temperature measurements over BLE.

   Find out more on the API usage at: https://docs.silabs.com/bluetooth/latest/bluetooth-stack-api/

   This example only works with the 'BLE (Silabs)' protocol stack variant.

   You can test the thermometer device with the EFR Connect app:
    - https://play.google.com/store/apps/details?id=com.siliconlabs.bledemo
    - https://apps.apple.com/us/app/efr-connect-ble-mobile-app/id1030932759

   Compatible boards:
   - Arduino Nano Matter
   - SparkFun Thing Plus MGM240P
   - xG27 DevKit
   - xG24 Explorer Kit
   - xG24 Dev Kit
   - BGM220 Explorer Kit
   - Ezurio Lyra 24P 20dBm Dev Kit
   - Seeed Studio XIAO MG24 (Sense)

   Author: Tamas Jozsi (Silicon Labs)
 */
 
#define RF_SW_PW_PIN PB5
#define RF_SW_PIN PB4

static void handle_temperature_indication();
static void ble_initialize_gatt_db();
static void ble_start_advertising();

const uint8_t advertised_name[] = "XIAOMG24_BLE";
uint8_t connection_handle = 0u;
uint16_t temp_measurement_characteristic_handle = 0u;
bool indication_enabled = false;

void setup()
{
  pinMode(LED_BUILTIN, OUTPUT);
  digitalWrite(LED_BUILTIN, LED_BUILTIN_INACTIVE);
  Serial.begin(115200);
  
  // turn on this antenna function
  pinMode(RF_SW_PW_PIN, OUTPUT);  
  digitalWrite(RF_SW_PW_PIN, HIGH);

  delay(100);

  // HIGH -> Use external antenna / LOW -> Use built-in antenna
  pinMode(RF_SW_PIN, OUTPUT);  
  digitalWrite(RF_SW_PIN, LOW);
}

void loop()
{
  handle_temperature_indication();
}

/**************************************************************************//**
 * Sends a BLE indication with the current temperature to the connected device
 * if enabled, then waits for a second
 *****************************************************************************/
static void handle_temperature_indication()
{
  // Return immediately if indications are not enabled
  if (!indication_enabled) {
    return;
  }

  // Get the current CPU temperature
  float temperature = getCPUTemp();

  // Convert the temperature to an IEEE 11073 float value
  int32_t millicelsius = (int32_t)(temperature * 1000);
  uint8_t buffer[5];
  uint32_t tmp_value = ((uint32_t)millicelsius & 0x00ffffffu) | ((uint32_t)(-3) << 24);
  buffer[0] = 0;
  buffer[1] = tmp_value & 0xff;
  buffer[2] = (tmp_value >> 8) & 0xff;
  buffer[3] = (tmp_value >> 16) & 0xff;
  buffer[4] = (tmp_value >> 24) & 0xff;

  // Send the indication
  sl_bt_gatt_server_send_indication(connection_handle, temp_measurement_characteristic_handle, sizeof(buffer), buffer);

  // Log the temperature
  Serial.print("Temperature indication sent - current temperature: ");
  Serial.print(temperature);
  Serial.println(" C");

  // Wait for a second
  delay(1000);
}

/**************************************************************************//**
 * Bluetooth stack event handler
 * Called when an event happens on BLE the stack
 *
 * @param[in] evt Event coming from the Bluetooth stack
 *****************************************************************************/
void sl_bt_on_event(sl_bt_msg_t *evt)
{
  switch (SL_BT_MSG_ID(evt->header)) {
    // This event is received when the BLE device has successfully booted
    case sl_bt_evt_system_boot_id:
    {
      // Print a welcome message
      Serial.begin(115200);
      Serial.println();
      Serial.println("Silicon Labs BLE health thermometer example");
      Serial.println("BLE stack booted");
      // Initialize the application specific GATT DB
      ble_initialize_gatt_db();
      // Start advertising
      ble_start_advertising();
    }
    break;

    // This event is received when a BLE connection has been opened
    case sl_bt_evt_connection_opened_id:
      // Store the connection handle which will be needed for sending indications
      connection_handle = evt->data.evt_connection_opened.connection;
      Serial.println("Connection opened");
      digitalWrite(LED_BUILTIN, LED_BUILTIN_ACTIVE);
      break;

    // This event is received when a BLE connection has been closed
    case sl_bt_evt_connection_closed_id:
      // Reset stored values
      connection_handle = 0u;
      indication_enabled = false;
      Serial.println("Connection closed");
      digitalWrite(LED_BUILTIN, LED_BUILTIN_INACTIVE);
      // Restart the advertisement
      ble_start_advertising();
      break;

    // This event is received when a GATT characteristic status changes
    case sl_bt_evt_gatt_server_characteristic_status_id:
    {
      // If the temperature measurement characteristic has been changed
      if (evt->data.evt_gatt_server_characteristic_status.characteristic == temp_measurement_characteristic_handle) {
        uint16_t client_config_flags = evt->data.evt_gatt_server_characteristic_status.client_config_flags;
        uint8_t status_flags = evt->data.evt_gatt_server_characteristic_status.status_flags;
        if ((client_config_flags == 0x02) && (status_flags == 0x01)) {
          // If indication was enabled (0x02) in the client config flags, and the status flag shows that it's a change
          Serial.println("Temperature indication enabled");
          indication_enabled = true;
        } else if ((client_config_flags == 0x00) && (status_flags == 0x01)) {
          // If indication was disabled (0x00) in the client config flags, and the status flag shows that it's a change
          Serial.println("Temperature indication disabled");
          indication_enabled = false;
        }
      }
    }
    break;

    // Default event handler
    default:
      Serial.print("BLE event: 0x");
      Serial.println(SL_BT_MSG_ID(evt->header), HEX);
      break;
  }
}

/**************************************************************************//**
 * Starts BLE advertisement
 * Initializes advertising if it's called for the first time
 *****************************************************************************/
static void ble_start_advertising()
{
  static uint8_t advertising_set_handle = 0xff;
  static bool init = true;
  sl_status_t sc;

  if (init) {
    // Create an advertising set
    sc = sl_bt_advertiser_create_set(&advertising_set_handle);
    app_assert_status(sc);

    // Set advertising interval to 100ms
    sc = sl_bt_advertiser_set_timing(
      advertising_set_handle,
      160,   // minimum advertisement interval (milliseconds * 1.6)
      160,   // maximum advertisement interval (milliseconds * 1.6)
      0,     // advertisement duration
      0);    // maximum number of advertisement events
    app_assert_status(sc);

    init = false;
  }

  // Generate data for advertising
  sc = sl_bt_legacy_advertiser_generate_data(advertising_set_handle, sl_bt_advertiser_general_discoverable);
  app_assert_status(sc);

  // Start advertising and enable connections
  sc = sl_bt_legacy_advertiser_start(advertising_set_handle, sl_bt_advertiser_connectable_scannable);
  app_assert_status(sc);

  Serial.print("Started advertising as '");
  Serial.print((const char*)advertised_name);
  Serial.println("'...");
}

/**************************************************************************//**
 * Initializes the GATT database
 * Creates a new GATT session and adds certain services and characteristics
 *****************************************************************************/
static void ble_initialize_gatt_db()
{
  sl_status_t sc;
  uint16_t gattdb_session_id;
  uint16_t service_handle;
  uint16_t device_name_characteristic_handle;
  uint16_t temp_type_characteristic_handle;

  // Create a new GATT database
  sc = sl_bt_gattdb_new_session(&gattdb_session_id);
  app_assert_status(sc);

  // Generic Access service
  const uint8_t generic_access_service_uuid[] = { 0x00, 0x18 };
  sc = sl_bt_gattdb_add_service(gattdb_session_id,
                                sl_bt_gattdb_primary_service,
                                SL_BT_GATTDB_ADVERTISED_SERVICE,
                                sizeof(generic_access_service_uuid),
                                generic_access_service_uuid,
                                &service_handle);
  app_assert_status(sc);

  // Device Name characteristic
  const sl_bt_uuid_16_t device_name_characteristic_uuid = { .data = { 0x00, 0x2A } };
  sc = sl_bt_gattdb_add_uuid16_characteristic(gattdb_session_id,
                                              service_handle,
                                              SL_BT_GATTDB_CHARACTERISTIC_READ,
                                              0x00,
                                              0x00,
                                              device_name_characteristic_uuid,
                                              sl_bt_gattdb_fixed_length_value,
                                              sizeof(advertised_name) - 1,
                                              sizeof(advertised_name) - 1,
                                              advertised_name,
                                              &device_name_characteristic_handle);
  app_assert_status(sc);

  sc = sl_bt_gattdb_start_service(gattdb_session_id, service_handle);
  app_assert_status(sc);

  // Health Thermometer service
  const uint8_t thermometer_service_uuid[] = { 0x09, 0x18 };
  sc = sl_bt_gattdb_add_service(gattdb_session_id,
                                sl_bt_gattdb_primary_service,
                                SL_BT_GATTDB_ADVERTISED_SERVICE,
                                sizeof(thermometer_service_uuid),
                                thermometer_service_uuid,
                                &service_handle);
  app_assert_status(sc);

  // Temperature Measurement characteristic
  const sl_bt_uuid_16_t temp_measurement_characteristic_uuid = { .data = { 0x1C, 0x2A } };
  uint8_t temp_initial_value[5] = { 0, 0, 0, 0, 0 };
  sc = sl_bt_gattdb_add_uuid16_characteristic(gattdb_session_id,
                                              service_handle,
                                              SL_BT_GATTDB_CHARACTERISTIC_INDICATE,
                                              0x00,
                                              0x00,
                                              temp_measurement_characteristic_uuid,
                                              sl_bt_gattdb_fixed_length_value,
                                              5,
                                              5,
                                              temp_initial_value,
                                              &temp_measurement_characteristic_handle);
  app_assert_status(sc);

  // Temperature Type characteristic
  const sl_bt_uuid_16_t temp_type_characteristic_uuid = { .data = { 0x1D, 0x2A } };
  // Temperature type: body (2)
  uint8_t temp_type_initial_value = 2;
  sc = sl_bt_gattdb_add_uuid16_characteristic(gattdb_session_id,
                                              service_handle,
                                              SL_BT_GATTDB_CHARACTERISTIC_READ,
                                              0x00,
                                              0x00,
                                              temp_type_characteristic_uuid,
                                              sl_bt_gattdb_fixed_length_value,
                                              1,
                                              1,
                                              &temp_type_initial_value,
                                              &temp_type_characteristic_handle);
  app_assert_status(sc);

  // Start the Health Thermometer service
  sc = sl_bt_gattdb_start_service(gattdb_session_id, service_handle);
  app_assert_status(sc);

  // Commit the GATT DB changes
  sc = sl_bt_gattdb_commit(gattdb_session_id);
  app_assert_status(sc);
}

#ifndef BLE_STACK_SILABS
  #error "This example is only compatible with the Silicon Labs BLE stack. Please select 'BLE (Silabs)' in 'Tools > Protocol stack'."
#endif
```

ä¸ºå…¶ä¸­ä¸€ä¸ª XIAO ä¸Šä¼ ç¨‹åºåï¼Œå¦‚æœç¨‹åºè¿è¡Œé¡ºåˆ©ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ‹¿å‡ºæ‰‹æœºå¹¶ä½¿ç”¨ nRF Connect APP æœç´¢åä¸º **XIAOMG24_BLE** çš„è“ç‰™è®¾å¤‡ï¼Œè¿æ¥å®ƒï¼Œç„¶åç‚¹å‡»ä¸‹é¢æ˜¾ç¤ºçš„æŒ‰é’®ï¼Œæ‚¨å°†æ”¶åˆ°æ¸©åº¦æ•°æ®ä¿¡æ¯ã€‚

<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/BLEServer-5.jpg" style={{width:300, height:'auto'}}/></div>

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿å‡ºå¦ä¸€ä¸ª XIAOï¼Œå®ƒå……å½“å®¢æˆ·ç«¯æ¥æ”¶é›†å’Œæ˜¾ç¤ºæˆ‘ä»¬çš„æ•°æ®ã€‚

```c
// client

/*
   BLE health thermometer client example

   The example connects to another board running the 'BLE Health Thermometer' example and reads the temperature through BLE

   On startup the sketch will start a scanning for the other board running the 'ble_health_thermometer' example and
   advertising as "Thermometer Example". Once the other board is found, it establishes a connection,
   discovers it's services and characteristics, then subscribes to the temperature measurements.
   After the subscription the example starts receiving the temperature data from the other board periodically,
   and prints it to Serial.

   Find out more on the API usage at: https://docs.silabs.com/bluetooth/latest/bluetooth-stack-api/

   This example only works with the 'BLE (Silabs)' protocol stack variant.

   Compatible boards:
   - Arduino Nano Matter
   - SparkFun Thing Plus MGM240P
   - xG27 DevKit
   - xG24 Explorer Kit
   - xG24 Dev Kit
   - BGM220 Explorer Kit
   - Ezurio Lyra 24P 20dBm Dev Kit
   - Seeed Studio XIAO MG24 (Sense)

   Author: Tamas Jozsi (Silicon Labs)
 */

#define RF_SW_PW_PIN PB5
#define RF_SW_PIN PB4

void setup()
{
  pinMode(LED_BUILTIN, OUTPUT);
  digitalWrite(LED_BUILTIN, LED_BUILTIN_INACTIVE);
  Serial.begin(115200);

  // turn on this antenna function
  pinMode(RF_SW_PW_PIN, OUTPUT);  
  digitalWrite(RF_SW_PW_PIN, HIGH);

  delay(100);

  // HIGH -> Use external antenna / LOW -> Use built-in antenna
  pinMode(RF_SW_PIN, OUTPUT);  
  digitalWrite(RF_SW_PIN, LOW);
}

void loop()
{
}

// Connection states
enum conn_state_t {
  ST_BOOT,
  ST_SCAN,
  ST_CONNECT,
  ST_SERVICE_DISCOVER,
  ST_CHAR_DISCOVER,
  ST_REQUEST_INDICATION,
  ST_RECEIVE_DATA
};

// IEEE 11073 float structure
typedef struct {
  uint8_t mantissa_l;
  uint8_t mantissa_m;
  int8_t mantissa_h;
  int8_t exponent;
} IEEE_11073_float;

static bool find_complete_local_name_in_advertisement(sl_bt_evt_scanner_legacy_advertisement_report_t *response);
static float translate_IEEE_11073_temperature_to_float(IEEE_11073_float const *IEEE_11073_value);

const uint8_t thermometer_service_uuid[] = { 0x09, 0x18 };
const sl_bt_uuid_16_t temp_measurement_characteristic_uuid = { .data = { 0x1C, 0x2A } };
const uint8_t advertised_name[] = "XIAOMG24_BLE";

uint32_t thermometer_service_handle = __UINT32_MAX__;
uint16_t temp_measurement_char_handle = __UINT16_MAX__;
conn_state_t connection_state = ST_BOOT;

/**************************************************************************//**
 * Bluetooth stack event handler
 * Called when an event happens on BLE the stack
 *
 * @param[in] evt Event coming from the Bluetooth stack
 *****************************************************************************/
void sl_bt_on_event(sl_bt_msg_t *evt)
{
  sl_status_t sc;

  switch (SL_BT_MSG_ID(evt->header)) {
    // This event is received when the BLE device has successfully booted
    case sl_bt_evt_system_boot_id:
      // Print a welcome message
      Serial.println();
      Serial.println("Silicon Labs BLE health thermometer client example");
      Serial.println("BLE stack booted");
      // Start scanning for other BLE devices
      sc = sl_bt_scanner_set_parameters(sl_bt_scanner_scan_mode_active, 16, 16);
      app_assert_status(sc);
      sc = sl_bt_scanner_start(sl_bt_scanner_scan_phy_1m,
                               sl_bt_scanner_discover_generic);
      app_assert_status(sc);
      Serial.println("Started scanning...");
      connection_state = ST_SCAN;
      break;

    // This event is received when we scan the advertisement of another BLE device
    case sl_bt_evt_scanner_legacy_advertisement_report_id:
      Serial.println("BLE scan report received");
      // If we find the other devices's name
      if (find_complete_local_name_in_advertisement(&(evt->data.evt_scanner_legacy_advertisement_report))) {
        Serial.println("Target device found");
        // Stop scanning
        sc = sl_bt_scanner_stop();
        app_assert_status(sc);
        // Connect to the device
        sc = sl_bt_connection_open(evt->data.evt_scanner_legacy_advertisement_report.address,
                                   evt->data.evt_scanner_legacy_advertisement_report.address_type,
                                   sl_bt_gap_phy_1m,
                                   NULL);
        app_assert_status(sc);
        connection_state = ST_CONNECT;
      }
      break;

    // This event is received when a BLE connection has been opened
    case sl_bt_evt_connection_opened_id:
      Serial.println("Connection opened");
      digitalWrite(LED_BUILTIN, LED_BUILTIN_ACTIVE);
      // Discover Health Thermometer service on the connected device
      sc = sl_bt_gatt_discover_primary_services_by_uuid(evt->data.evt_connection_opened.connection,
                                                        sizeof(thermometer_service_uuid),
                                                        thermometer_service_uuid);
      app_assert_status(sc);
      connection_state = ST_SERVICE_DISCOVER;
      break;

    // This event is received when a BLE connection has been closed
    case sl_bt_evt_connection_closed_id:
      Serial.println("Connection closed");
      digitalWrite(LED_BUILTIN, LED_BUILTIN_INACTIVE);
      // Restart scanning
      sc = sl_bt_scanner_start(sl_bt_scanner_scan_phy_1m,
                               sl_bt_scanner_discover_generic);
      app_assert_status(sc);
      Serial.println("Restarted scanning...");
      connection_state = ST_SCAN;
      break;

    // This event is generated when a new service is discovered
    case sl_bt_evt_gatt_service_id:
      Serial.println("GATT service discovered");
      // Store the handle of the discovered Thermometer Service
      thermometer_service_handle = evt->data.evt_gatt_service.service;
      break;

    // This event is generated when a new characteristic is discovered
    case sl_bt_evt_gatt_characteristic_id:
      Serial.println("GATT charactersitic discovered");
      // Store the handle of the discovered Temperature Measurement characteristic
      temp_measurement_char_handle = evt->data.evt_gatt_characteristic.characteristic;
      break;

    // This event is received when a GATT procedure completes
    case sl_bt_evt_gatt_procedure_completed_id:
      Serial.println("GATT procedure completed");

      if (connection_state == ST_SERVICE_DISCOVER) {
        Serial.println("GATT service discovery finished");
        // Discover thermometer characteristic on the connected device
        sc = sl_bt_gatt_discover_characteristics_by_uuid(evt->data.evt_gatt_procedure_completed.connection,
                                                         thermometer_service_handle,
                                                         sizeof(temp_measurement_characteristic_uuid.data),
                                                         temp_measurement_characteristic_uuid.data);
        app_assert_status(sc);
        connection_state = ST_CHAR_DISCOVER;
        break;
      }

      if (connection_state == ST_CHAR_DISCOVER) {
        Serial.println("GATT characteristic discovery finished");
        // Enable temperature measurement indications
        sc = sl_bt_gatt_set_characteristic_notification(evt->data.evt_gatt_procedure_completed.connection,
                                                        temp_measurement_char_handle,
                                                        sl_bt_gatt_indication);
        app_assert_status(sc);
        connection_state = ST_REQUEST_INDICATION;
        break;
      }

      if (connection_state == ST_REQUEST_INDICATION) {
        Serial.println("Temperature measurement indications enabled");
        connection_state = ST_RECEIVE_DATA;
      }
      break;

    // This event is received when a characteristic value was received (like an indication)
    case sl_bt_evt_gatt_characteristic_value_id:
    {
      Serial.println("GATT data received");
      // Get the received data from the event
      uint8_t* char_value = &(evt->data.evt_gatt_characteristic_value.value.data[0]);
      // Convert it back to float
      float temperature = translate_IEEE_11073_temperature_to_float((IEEE_11073_float *)(char_value + 1));
      // Print to Serial
      Serial.print("Received temperature: ");
      Serial.print(temperature);
      Serial.println(" C");

      sc = sl_bt_gatt_send_characteristic_confirmation(evt->data.evt_gatt_characteristic_value.connection);
      app_assert_status(sc);
    }
    break;

    // Default event handler
    default:
      Serial.print("BLE event: 0x");
      Serial.println(SL_BT_MSG_ID(evt->header), HEX);
      break;
  }
}

/**************************************************************************//**
 * Finds a configured name in BLE advertisements
 *
 * @param[in] response BLE response event received from scanning
 *
 * @return true if found, false otherwise
 *****************************************************************************/
static bool find_complete_local_name_in_advertisement(sl_bt_evt_scanner_legacy_advertisement_report_t *response)
{
  int i = 0;
  bool found = false;

  // Go through the response data
  while (i < (response->data.len - 1)) {
    uint8_t advertisement_length = response->data.data[i];
    uint8_t advertisement_type = response->data.data[i + 1];

    // Type 0x09 = Complete Local Name, 0x08 Shortened Name
    // If the field type matches the Complete Local Name
    if (advertisement_type == 0x09) {
      // Check if device name matches
      if (memcmp(response->data.data + i + 2, advertised_name, strlen((const char*)advertised_name)) == 0) {
        found = true;
        break;
      }
    }
    // Jump to next advertisement record
    i = i + advertisement_length + 1;
  }
  return found;
}

/**************************************************************************//**
 * Translates a IEEE-11073 temperature value to float
 *
 * @param[in] IEEE_11073_value the IEEE 11073 float value to convert
 *
 * @return the converted value in float, NAN on failure
 *****************************************************************************/
static float translate_IEEE_11073_temperature_to_float(IEEE_11073_float const *IEEE_11073_value)
{
  int32_t mantissa = 0;
  uint8_t mantissa_l;
  uint8_t mantissa_m;
  int8_t mantissa_h;
  int8_t exponent;

  // Wrong Argument: NULL pointer is passed
  if (!IEEE_11073_value) {
    return NAN;
  }

  // Caching Fields
  mantissa_l = IEEE_11073_value->mantissa_l;
  mantissa_m = IEEE_11073_value->mantissa_m;
  mantissa_h = IEEE_11073_value->mantissa_h;
  exponent =  IEEE_11073_value->exponent;

  // IEEE-11073 Standard NaN Value Passed
  if ((mantissa_l == 0xFF) && (mantissa_m == 0xFF) && (mantissa_h == 0x7F) && (exponent == 0x00)) {
    return NAN;
  }

  // Converting a 24bit Signed Value to a 32bit Signed Value
  mantissa |= mantissa_h;
  mantissa <<= 8;
  mantissa |= mantissa_m;
  mantissa <<= 8;
  mantissa |= mantissa_l;
  mantissa <<= 8;
  mantissa >>= 8;

  return ((float)mantissa) * pow(10.0f, (float)exponent);
}

#ifndef BLE_STACK_SILABS
  #error "This example is only compatible with the Silicon Labs BLE stack. Please select 'BLE (Silabs)' in 'Tools > Protocol stack'."
#endif
```

æœ€åï¼Œå¦‚æœæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç¨‹åºè¿è¡Œé¡ºåˆ©ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¸²å£çœ‹åˆ°å®¢æˆ·ç«¯æ‰“å°çš„ä»¥ä¸‹ä¿¡æ¯ã€‚

<div style={{textAlign:'center'}}><img src="https://files.seeedstudio.com/wiki/XIAO_MG24/Bluetooth/BLEClient_result-1.png" style={{width:700, height:'auto'}}/></div>

#### ç¨‹åºæ³¨é‡Š

å¯¹äºä¸Šè¿°ç¨‹åºï¼Œæˆ‘ä»¬å°†æŒ‘é€‰æ›´é‡è¦çš„éƒ¨åˆ†è¿›è¡Œè§£é‡Šã€‚æˆ‘ä»¬å°†ä»æœåŠ¡å™¨ç¨‹åºå¼€å§‹ã€‚

åœ¨ç¨‹åºå¼€å§‹æ—¶ï¼Œæˆ‘ä»¬å®šä¹‰äº†è“ç‰™æœåŠ¡å™¨çš„åç§°ï¼Œè¿™ä¸ªåç§°å¯ä»¥æ˜¯æ‚¨è®¾ç½®çš„åç§°ï¼Œä½†æ‚¨éœ€è¦è®°ä½å®ƒï¼Œå› ä¸ºæ‚¨éœ€è¦ä¾é è¿™ä¸ªåç§°æ¥æœç´¢è¿™ä¸ªè“ç‰™è®¾å¤‡ã€‚

```c
const uint8_t advertised_name[] = "XIAOMG24_BLE";
```

åœ¨æœ¬æ•™ç¨‹çš„å‰é¢éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºè¿‡åœ¨æœåŠ¡å™¨ä¸‹ä¼šæœ‰ç‰¹å¾å€¼ï¼Œåœ¨ç‰¹å¾å€¼ä¸‹ä¼šæœ‰æ•°å€¼å’Œå…¶ä½™å†…å®¹ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºå¹¿å‘Šæ—¶éœ€è¦éµå¾ªè¿™ä¸€åŸåˆ™ã€‚

```c
// Health Thermometer service
const uint8_t thermometer_service_uuid[] = { 0x09, 0x18 };
sc = sl_bt_gattdb_add_service(gattdb_session_id,
                              sl_bt_gattdb_primary_service,
                              SL_BT_GATTDB_ADVERTISED_SERVICE,
                              sizeof(thermometer_service_uuid),
                              thermometer_service_uuid,
                              &service_handle);
app_assert_status(sc);

// Temperature Measurement characteristic
const sl_bt_uuid_16_t temp_measurement_characteristic_uuid = { .data = { 0x1C, 0x2A } };
uint8_t temp_initial_value[5] = { 0, 0, 0, 0, 0 };
sc = sl_bt_gattdb_add_uuid16_characteristic(gattdb_session_id,
                                            service_handle,
                                            SL_BT_GATTDB_CHARACTERISTIC_INDICATE,
                                            0x00,
                                            0x00,
                                            temp_measurement_characteristic_uuid,
                                            sl_bt_gattdb_fixed_length_value,
                                            5,
                                            5,
                                            temp_initial_value,
                                            &temp_measurement_characteristic_handle);
app_assert_status(sc);
```

åœ¨ä¸Šè¿°ç¨‹åºä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ° `sl_bt_gattdb_add_service()` ç”¨äºåˆ›å»ºæœåŠ¡å™¨ã€‚å‚æ•°æ˜¯ä¸€ä¸ªç‰¹å®šçš„ UUIDï¼š**0x1809**ã€‚åœ¨ GATT è§„åˆ™ä¸­ï¼Œ**0x1809** è¡¨ç¤ºæ¸©åº¦è®¡ç±»å‹æ•°æ®ï¼Œç›¸åŒç‰¹å¾çš„ UUIDï¼š**0x2A1C** ä¹Ÿæœ‰ç‰¹æ®Šå«ä¹‰ã€‚åœ¨ GATT ä¸­ï¼Œå®ƒè¡¨ç¤ºæ¸©åº¦æµ‹é‡ã€‚è¿™ç¬¦åˆæˆ‘ä»¬æ¸©åº¦å€¼çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œå°†å…¶å®šä¹‰ä¸ºè¿™æ ·ã€‚æ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/res/GATT.pdf)é˜…è¯» GATT ä¸ºæˆ‘ä»¬å‡†å¤‡çš„ä¸€äº›ç‰¹å®š UUID çš„å«ä¹‰ã€‚

å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¸éµå¾ª GATT æ ‡å‡†æ¥è®¾ç½® UUIDï¼Œæ‚¨åªéœ€è¦ç¡®ä¿è¿™ä¸¤ä¸ªå€¼æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“æ‚¨çš„å®¢æˆ·ç«¯é€šè¿‡è¯†åˆ«è¿™äº› UUID æ¥æ‰¾åˆ°å€¼çš„èƒ½åŠ›ã€‚æ‚¨å¯ä»¥è®¿é—® [uuidgenerator.net](https://www.uuidgenerator.net/) ä¸ºæ‚¨çš„æœåŠ¡å’Œç‰¹å¾åˆ›å»ºéšæœº UUIDã€‚

æœ€åï¼Œæˆ‘ä»¬åœ¨ `loop` ä¸­æ¯ç§’æµ‹é‡å¹¶å¹¿æ’­ä¸€æ¬¡ MCU çš„æ¸©åº¦å€¼ã€‚

ä¸‹ä¸€æ­¥æ˜¯å®¢æˆ·ç«¯ç¨‹åºï¼Œè¿™çœ‹èµ·æ¥ä¼šå¤æ‚å¾—å¤šã€‚

åœ¨ç¨‹åºå¼€å§‹æ—¶ï¼Œä»ç„¶æ˜¯éå¸¸ç†Ÿæ‚‰çš„å†…å®¹ã€‚æ‚¨éœ€è¦ç¡®ä¿æ­¤å†…å®¹ä¸æ‚¨åœ¨æœåŠ¡å™¨ç«¯é…ç½®çš„å†…å®¹ä¸€è‡´ã€‚

```c
const uint8_t thermometer_service_uuid[] = { 0x09, 0x18 };
const sl_bt_uuid_16_t temp_measurement_characteristic_uuid = { .data = { 0x1C, 0x2A } };
const uint8_t advertised_name[] = "XIAOMG24_BLE";
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªè“ç‰™åè®®æ ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä¸»è¦å¤„ç†å„ç§è“ç‰™äº‹ä»¶è§¦å‘çš„å›è°ƒä»»åŠ¡ï¼ŒåŒ…æ‹¬è“ç‰™è®¾å¤‡çš„åˆå§‹åŒ–ã€è“ç‰™çš„è¿æ¥å’Œæ–­å¼€è¿æ¥ï¼Œä»¥åŠæœç´¢é™„è¿‘çš„è“ç‰™è®¾å¤‡ã€‚

```c
/**************************************************************************//**
 * Bluetooth stack event handler
 * Called when an event happens on BLE the stack
 *
 * @param[in] evt Event coming from the Bluetooth stack
 *****************************************************************************/
void sl_bt_on_event(sl_bt_msg_t *evt)
```

ä»¥ä¸‹è¿‡ç¨‹æ˜¯åœ¨æœåŠ¡å™¨ä¸­æŸ¥æ‰¾æ¸©åº¦å€¼çš„å…³é”®ã€‚é¦–å…ˆï¼Œåœ¨æˆ‘ä»¬æˆåŠŸå®šä½æœåŠ¡å™¨UUIDå¹¶æ‰¾åˆ°æœåŠ¡å™¨ä¸‹çš„ç‰¹å¾UUIDåï¼Œæˆ‘ä»¬å°†å¤„ç†è·å¾—çš„æ•°æ®ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ‰€ç¤ºã€‚æœ€åï¼Œé€šè¿‡ä¸²å£æ‰“å°å‡ºå¤„ç†åçš„æ•°æ®ã€‚è¿™ç§è§£ææ–¹æ³•ä¸è“ç‰™çš„æ•°æ®ç»“æ„æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚

```c
void sl_bt_on_event(sl_bt_msg_t *evt)
{
  sl_status_t sc;

  switch (SL_BT_MSG_ID(evt->header)) {
    
    ...

    // This event is received when a characteristic value was received (like an indication)
    case sl_bt_evt_gatt_characteristic_value_id:
    {
      Serial.println("GATT data received");
      // Get the received data from the event
      uint8_t* char_value = &(evt->data.evt_gatt_characteristic_value.value.data[0]);
      // Convert it back to float
      float temperature = translate_IEEE_11073_temperature_to_float((IEEE_11073_float *)(char_value + 1));
      // Print to Serial
      Serial.print("Received temperature: ");
      Serial.print(temperature);
      Serial.println(" C");

      sc = sl_bt_gatt_send_characteristic_confirmation(evt->data.evt_gatt_characteristic_value.connection);
      app_assert_status(sc);
    }
    break;

    ...
  
  }
}
```


:::tip
ä¸Šé¢çš„ç¤ºä¾‹ç»™å‡ºäº†æ¥è‡ªSilicon Labsçš„å•ä¸ªä¼ æ„Ÿå™¨å•ä¸ªå€¼çš„æœ€ç®€å•ç¤ºä¾‹ã€‚å¦‚æœæ‚¨æƒ³æ›´æ·±å…¥åœ°äº†è§£SiliconLabs BLE APIçš„ä½¿ç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨é˜…è¯»è¿™é‡Œçš„æ•™ç¨‹ã€‚

- [SiliconLabs Bluetooth Stack API Reference](https://docs.silabs.com/bluetooth/latest/bluetooth-stack-api/)
:::


## æŠ€æœ¯æ”¯æŒä¸äº§å“è®¨è®º

æ„Ÿè°¢æ‚¨é€‰æ‹©æˆ‘ä»¬çš„äº§å“ï¼æˆ‘ä»¬åœ¨è¿™é‡Œä¸ºæ‚¨æä¾›ä¸åŒçš„æ”¯æŒï¼Œä»¥ç¡®ä¿æ‚¨ä½¿ç”¨æˆ‘ä»¬äº§å“çš„ä½“éªŒå°½å¯èƒ½é¡ºç•…ã€‚æˆ‘ä»¬æä¾›å¤šç§æ²Ÿé€šæ¸ é“ï¼Œä»¥æ»¡è¶³ä¸åŒçš„åå¥½å’Œéœ€æ±‚ã€‚

<div class="button_tech_support_container">
<a href="https://forum.seeedstudio.com/" class="button_forum"></a> 
<a href="https://www.seeedstudio.com/contacts" class="button_email"></a>
</div>

<div class="button_tech_support_container">
<a href="https://discord.gg/eWkprNDMU7" class="button_discord"></a> 
<a href="https://github.com/Seeed-Studio/wiki-documents/discussions/69" class="button_discussion"></a>
</div>
